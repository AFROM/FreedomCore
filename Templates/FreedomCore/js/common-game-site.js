"use strict";var App={initialize:function(){var links=$('a[rel="javascript"]');if(links.length){links.removeAttr('onclick').removeAttr('onmouseover').removeAttr('title').css('cursor','pointer');}
var supportLink=$('#support-link'),exploreLink=$('#explore-link'),newsLink=$('#breaking-link'),authLink=$('#auth-link');if(supportLink.length>0){supportLink.unbind().click(function(){Tickets.loadStatus();Toggle.open(this,'active','#support-menu');return false;});}
if(authLink.length>0){authLink.unbind().click(function(){Marketing.trackImpression('Battle.net Authenticator','Menu Toggle',$('#auth-menu').is(':hidden')?'Open':'Close');Toggle.open(this,'active','#auth-menu');return false;});$('#auth-menu a').click(function(){var label;if(this.className==='auth-close'){Toggle.open(authLink,'active','#auth-menu');authLink.parent().hide();label='Close';}else if(this.className==='auth-button'){label='Add';}else{label='More';}
Marketing.trackImpression('Battle.net Authenticator','Link Click',label);Cookie.create('serviceBar.authCheck',1,{expires:744,path:'/'});});Marketing.trackImpression('Battle.net Authenticator','Impression','Impression');}
if(exploreLink.length>0){exploreLink.unbind().click(function(){Toggle.open(this,'active','#explore-menu');return false;});}
if(newsLink.length>0){newsLink.unbind().click(function(){App.breakingNews();return false;});}},closeWarning:function(target,cookie){$(target).hide();if(cookie)App.saveCookie(cookie);},breakingNews:function(lastId){var node=$("#breaking-news");var news=$("#announcement-warning");if(news.is(':visible')){news.hide();node.removeClass('opened');}else{news.show();node.addClass('opened');}
if(lastId){Cookie.create('serviceBar.breakingNews',lastId);}},saveCookie:function(name){Cookie.create('serviceBar.'+name,1,{expires:8760,path:'/'});},resetCookie:function(name){Cookie.create('serviceBar.'+name,0,{expires:8760,path:'/'});},serviceBar:function(){var browser=Cookie.read('serviceBar.browserWarning');var locale=Cookie.read('serviceBar.localeWarning');if(browser===1)$('#browser-warning').hide();if(locale===1)$('#i18n-warning').hide();},totalModules:0,totalLoaded:0,modules:[],forceLoad:true,sidebar:function(modules){App.totalModules=modules.length;if(modules.length){for(var i=0;i<=(modules.length-1);++i){App.loadModule(modules[i],i);}}
window.setTimeout(function(){if(App.forceLoad){App.showSidebar();}},5000);},showSidebar:function(){App.forceLoad=false;var dynamicSidebarTarget=$("#dynamic-sidebar-target");var sidebar=$('#sidebar .sidebar-bot');for(var i=0;i<App.totalModules;i++){if(App.modules[i]){App.modules[i].appendTo(dynamicSidebarTarget);}}
$('#sidebar-loading').fadeOut('normal',function(){sidebar.find('.sidebar-module').fadeIn();$(this).remove();});App.modules=[];App.totalModules=0;App.totalLoaded=0;},loadModule:function(module,index){var dynamicSidebarTarget=$("#dynamic-sidebar-target");$.ajax({url:Core.baseUrl+'/sidebar/'+module.type+(module.query||""),type:'GET',dataType:'html',cache:true,global:false,success:function(data){App.totalLoaded++;if($.trim(data)!==""){var node=$(data);if(App.forceLoad){node.hide();App.modules[index]=node;}else{node.appendTo(dynamicSidebarTarget);}}},error:function(){App.totalLoaded++;},complete:function(){if(App.totalLoaded>=App.totalModules){window.setTimeout(App.showSidebar,100);}}});}};$(function(){App.initialize();});var Blackout={initialized:false,element:null,shim:null,initialize:function(){Blackout.element=$('<div/>',{id:'blackout'});Blackout.element.on('click',Core.stopPropagation).on('keyup',Blackout.listen);$("body").append(Blackout.element);if(Core.browser.full==='ie6'){Blackout.element.css('backgroundColor','#000');Blackout.element.css('filter','alpha(opacity=70)');Blackout.shim=$('<iframe />',{src:'javascript:false;',frameborder:0,scrolling:'no'}).addClass('support-shim');Blackout.element.append(Blackout.shim);}
Blackout.initialized=true;},listen:function(e){if(e.which===KeyCode.esc){Blackout.hide();}},show:function(callback,onClick,transparent){if(!Blackout.initialized){Blackout.initialize();}
if(Core.isIE()){Blackout.element.css("width",Page.dimensions.width).css("height",$(document).height());if(Core.browser.full==='ie6'){Blackout.shim.css('width',Blackout.element.css('width')).css('height',Blackout.element.css('height'));if(Core.isCallback(onClick)){Blackout.shim[0].contentWindow.document.onclick=onClick;}}}
if(transparent){Blackout.element.addClass('blackout-transparent');}
Blackout.element.show();if(Core.isCallback(callback)){callback();}
if(Core.isCallback(onClick)){Blackout.element.click(onClick);}},hide:function(callback){Blackout.element.hide();if(Core.isCallback(callback)){callback();}
Blackout.element.unbind("click").removeClass('blackout-transparent');}};if(!Object.create){Object.create=function(o){if(arguments.length>1){throw new Error('Object.create implementation only accepts the first parameter.');}
function F(){}
F.prototype=o;return new F();};}
if(!Object.getPrototypeOf){if(typeof'test'.__proto__==='object'){Object.getPrototypeOf=function(object){return object.__proto__;};}else{Object.getPrototypeOf=function(object){return object.constructor.prototype;};}}
if(!String.fromCodePoint){String.fromCodePoint=function fromCodePoint(){var chars=[],point,offset,units,i;for(i=0;i<arguments.length;++i){point=arguments[i];offset=point-0x10000;units=point>0xFFFF?[0xD800+(offset>>10),0xDC00+(offset&0x3FF)]:[point];chars.push(String.fromCharCode.apply(null,units));}
return chars.join("");};}
if(!String.prototype.trim){String.prototype.trim=function(){return $.trim(this);};}
if(!String.prototype.capitalize){String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1);};}
jQuery.expr[":"].caseInsensitiveContains=typeof(jQuery.expr.createPseudo)=="function"?jQuery.expr.createPseudo(function(arg){return function(elem){return jQuery(elem).text().toLocaleLowerCase().indexOf(arg.toLocaleLowerCase())>=0;};}):function(elem,i,match){return jQuery(elem).text().toLocaleLowerCase().indexOf(match[3].toLocaleLowerCase())>=0;};jQuery.expr[":"].caseInsensitiveStartsWith=typeof(jQuery.expr.createPseudo)=="function"?jQuery.expr.createPseudo(function(searchString){return function(elem){return jQuery(elem).text().toLocaleLowerCase().indexOf(searchString.toLocaleLowerCase())===0;};}):function(elem,i,match){return jQuery(elem).text().toLocaleLowerCase().indexOf(match[3].toLocaleLowerCase())===0;};if(!jQuery.Event.prototype.stop){jQuery.Event.prototype.stop=function(){this.preventDefault();this.stopPropagation();};}
$.ajaxSetup({error:function(xhr){if(xhr.readyState!==4){return false;}
if(xhr.getResponseHeader("X-App")==="login"){Login.openOrRedirect();return false;}
if(xhr.status){switch(xhr.status){case 301:case 302:case 307:case 403:case 404:case 500:case 503:return false;break;}}
return true;},statusCode:{403:function(){Login.openOrRedirect();}}});var CharSelect={textareaContent:'',beforeCallback:null,afterCallback:null,initialize:function(){$(document).on('click','a.context-link',CharSelect.toggle);$('input.character-filter').on({blur:function(){Toggle.keepOpen=false;},keydown:function(e){if(e.which===KeyCode.enter){e.stopPropagation();e.preventDefault();}},keyup:CharSelect.filter});Input.bind('.character-filter');},pin:function(index,node){Tooltip.hide();$('div.character-list').html("").addClass('loading-chars');$.ajax({type:'POST',url:Core.baseUrl+'/account/pin/'+index,data:{index:index,xstoken:Cookie.read('xstoken')},global:false,success:function(response){if(Core.isIE()){location.reload(true);}
if(Core.isCallback(CharSelect.beforeCallback)&&CharSelect.beforeCallback(node)){return;}
CharSelect.updateComments(response);CharSelect.update();}})},update:function(){$.ajax({url:location.href,cache:false,global:false,error:function(){location.reload(true);},success:function(response){var pageData=$(typeof response==='string'?response:response.documentElement);$('.ajax-update').each(function(){var self=$(this),target;if(self.attr('id')){target='#'+self.attr('id');}else{target=self.attr('class').replace('ajax-update','').trim();target='.'+target.split(' ')[0];}
var clone=pageData.find(target+'.ajax-update').clone(),textarea=self.find('textarea');if(textarea.length&&textarea.val().length){CharSelect.textareaContent=textarea.val();}
if(clone.length){self.replaceWith(clone);}});if(Core.isCallback(CharSelect.afterCallback)){CharSelect.afterCallback();}}});},updateComments:function(response){var pageData=$(typeof response==='string'?response:response.documentElement);var commentsWrapper=$("#comments");if(commentsWrapper.length){var commentsForm=$(".comments-form",$("#comments"));$(".character-info",commentsForm).each(function(){var updatedCharacter=pageData.find('.character-info').clone();$(this).replaceWith(updatedCharacter);});$(".avatar-outer a",commentsForm).each(function(){var updatedAvatar=pageData.find('.portrait-b .avatar-interior a').clone();$(this).replaceWith(updatedAvatar);});if(typeof Comments!=="undefined"){$(".character-info",Comments.replyForm).each(function(){$(this).replaceWith(pageData.find('.character-info').clone());});$(".avatar-outer a",Comments.replyForm).each(function(){$(this).replaceWith(pageData.find('.portrait-b .avatar-interior a').clone());});}}},toggle:function(e){e.stop();Toggle.open(e.currentTarget,'context-open',$(e.currentTarget).siblings('.ui-context'));return false;},close:function(node){$(node).parents('.ui-context').hide().siblings('.context-link').removeClass('context-open');return false;},swipe:function(direction,target){var parent=$(target).parents('.chars-pane'),inDirection=(direction=='in')?'left':'right',outDirection=(direction=='in')?'right':'left';parent.hide('slide',{direction:inDirection},150,function(){parent.siblings('.chars-pane').show('slide',{direction:outDirection},150,function(){var scroll=$(this).find('.scrollbar-wrapper');if(scroll.length>0){scroll.tinyscrollbar();}});});},filter:function(e){e.stop();Toggle.keepOpen=true;if(e.keyCode==KeyCode.enter){return;}
var target=$(e.srcElement||e.currentTarget),filterVal=target.val().toLowerCase(),filterTable=target.parents('.chars-pane').find('.overview');if(e.keyCode==KeyCode.esc){target.val('');}
if(target.val().length<1){filterTable.children('a').removeClass('filtered');}else{filterTable.children('a').each(function(){$(this)[($(this).text().toLowerCase().indexOf(filterVal)>-1)?"removeClass":"addClass"]('filtered');});var allHidden=filterTable.children('a.filtered').length>=filterTable.children('a').length;filterTable.children('.no-results')[(allHidden)?"show":"hide"]();}
var scroll=target.parents('.chars-pane:first').find('.scrollbar-wrapper');if(scroll.length>0){scroll.tinyscrollbar();}}};$(function(){CharSelect.initialize();});var Cookie={cache:{},create:function(key,value,options){options=$.extend({},options);options.expires=options.expires||1;if(typeof options.expires==='number'){var hours=options.expires;options.expires=new Date();options.expires.setTime(options.expires.getTime()+(hours*3600000));}
var cookie=[encodeURIComponent(key)+'=',options.escape?encodeURIComponent(value):value,options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''];document.cookie=cookie.join('');if(Cookie.cache){if(options.expires.getTime()<(new Date()).getTime()){delete Cookie.cache[key];}else{Cookie.cache[key]=value;}}},read:function(key){if(Cookie.cache[key]){return Cookie.cache[key];}
var cache={};var cookies=document.cookie.split(';');if(cookies.length>0){for(var i=0;i<cookies.length;i++){var parts=cookies[i].split('=');if(parts.length>=2){cache[$.trim(parts[0])]=parts[1];}}}
Cookie.cache=cache;return cache[key]||null;},erase:function(key,options){if(!options){options={expires:-1};}else if(!options.expires){options.expires=-1;}
Cookie.create(key,0,options);},isSupported:function(){return(document.cookie.indexOf('=')!==-1);}};var Core={baseUrl:'/',supportUrl:'/support/',browser:null,deferredLoadQueue:[],locale:'en-us',region:'us',shortDateFormat:'MM/dd/Y',dateTimeFormat:'dd/MM/yyyy HH:mm',project:'',staticUrl:'/',sharedStaticUrl:'/local-common/',host:'',userAgent:'web',initialize:function(){Core.processLoadQueue();Core.ui();Core.host=location.protocol+'//'+(location.host||location.hostname);var html=$('html'),browser=Core.getBrowser();if(browser.name!==''){html.addClass(browser.name).addClass(browser.full);if(browser.name==='ie'&&(browser.version===6||browser.version===7)){html.addClass('ie67');}}},alpha:function(string){return string.replace(/[^a-zA-Z]/gi,'');},appendFrame:function(url,width,height,parent,id){if(typeof url==='undefined')return;if(typeof width==='undefined')width=1;if(typeof height==='undefined')height=1;if(typeof parent==='undefined')parent=$('body');if(Core.isIE()){parent.append('<iframe src="'+url+'" width="'+width+'" height="'+height+'" scrolling="no" frameborder="0" allowTransparency="true"'+((typeof id!=='undefined')?' id="'+id+'"':'')+'></iframe>');}else{parent.append('<object type="text/html" data="'+url+'" width="'+width+'" height="'+height+'"'+((typeof id!=='undefined')?' id="'+id+'"':'')+'></object>');}},escapeSelector:function(str){return typeof str==="string"?str.replace(/[^-\w]/g,"\\$&"):str},fixTableHeaders:function(query,baseHeight){$(query).each(function(){baseHeight=baseHeight||18;var table=$(this);var height=baseHeight;table.find('.sort-link').each(function(){var linkHeight=$(this).height();if(linkHeight>height){height=linkHeight;}});if(height>baseHeight){table.find('.sort-link, .sort-tab').css('height',height);}});},formatLocale:function(format,divider){divider=divider||'-';format=format||1;switch(format){case 1:default:return Core.locale.replace('-',divider);break;case 2:var parts=Core.locale.split('-');return parts[0]+divider+parts[1].toUpperCase();break;case 3:return Core.locale.toUpperCase().replace('-',divider);break;}},formatDatetime:function(format,datetime){var localDate;if(!datetime){localDate=new Date();}else{localDate=new Date(datetime);if(isNaN(localDate.getTime())){datetime=datetime.substring(0,10)+' '+datetime.substring(11,16)+':00 GMT'+datetime.substring(16,19)+datetime.substring(20,22);localDate=new Date(datetime);}
if(isNaN(localDate.getTime())){datetime=datetime.substring(0,4)+'/'+datetime.substring(5,7)+'/'+datetime.substring(8,29);localDate=new Date(datetime);}
if(isNaN(localDate.getTime())){datetime=datetime.substring(5,10)+' '+datetime.substring(11,16)+' GMT'+datetime.substring(23,28)+' '+datetime.substring(0,4);localDate=new Date(datetime);}
if(isNaN(localDate.getTime())){return false;}}
if(!format){format='yyyy-MM-ddThh:mmZ';}
var hr=localDate.getHours(),meridiem='AM';if(hr>12){hr-=12;meridiem='PM'}else if(hr===12){meridiem='PM'}else if(hr===0){hr=12;}
var tz=parseInt(localDate.getTimezoneOffset()/60*-1,10);if(tz<0){tz='-'+Core.zeroFill(Math.abs(tz),2)+':00';}else{tz=' + '+Core.zeroFill(Math.abs(tz),2)+':00';}
format=format.replace('yyyy',localDate.getFullYear());format=format.replace('MM',Core.zeroFill(localDate.getMonth()+1,2));format=format.replace('dd',Core.zeroFill(localDate.getDate(),2));format=format.replace('HH',Core.zeroFill(localDate.getHours(),2));format=format.replace('hh',Core.zeroFill(hr,2));format=format.replace('mm',Core.zeroFill(localDate.getMinutes(),2));format=format.replace('a',meridiem);format=format.replace('Z',tz);return format;},getBrowser:function(){if(Core.browser){return Core.browser;}
var s=$.support,browser='',version=0;if(!s.hrefNormalized&&!s.tbody&&!s.style&&!s.opacity){if(typeof document.body.style.maxHeight!=="undefined"||window.XMLHttpRequest){browser='ie';version=7;}else{browser='ie';version=6;}}else if(s.hrefNormalized&&s.tbody&&s.style&&!s.opacity){browser='ie';version=8;}else if(typeof $.browser!=='undefined'){if($.browser.mozilla){browser='ff';}else if($.browser.msie){browser='ie';}else if($.browser.webkit){if(navigator.userAgent.toLowerCase().indexOf('chrome')>=0){browser='chrome';}else{browser='safari';}}else if($.browser.opera){browser='opera';}
version=parseInt($.browser.version,10);}
Core.browser={name:browser,full:browser+version,version:version};return Core.browser;},getHash:function(){var hash=location.hash||"";return hash.substr(1,hash.length);},getLanguage:function(){return Core.locale.split('-')[0];},getRegion:function(){return Core.locale.split('-')[1];},goTo:function(url,base){window.location.href=(base?Core.baseUrl:'')+url;if(window.event)window.event.returnValue=false;},include:function(url,success,cache){$.ajax({url:url,dataType:'script',success:success,cache:cache!==false});},isCallback:function(callback){return(callback&&typeof callback==='function');},isIE:function(version){var browser=Core.getBrowser();if(version){return(version===browser.version)}
return(browser.name==='ie');},load:function(path,deferred,callback){deferred=deferred!==false;if(Page.loaded||!deferred){Core.loadDeferred(path,callback);}else{Core.deferredLoadQueue.push(path);}},loadDeferred:function(path,callback){var queryIndex=path.indexOf("?");var extIndex=path.lastIndexOf(".")+1;var ext=path.substring(extIndex,queryIndex===-1?path.length:queryIndex);switch(ext){case'js':Core.loadDeferredScript(path,callback);break;case'css':Core.loadDeferredStyle(path);break;}},loadDeferredScript:function(path,callback){$.ajax({url:path,cache:true,global:false,dataType:'script',success:callback});},loadDeferredStyle:function(path,media){$('head').append('<link rel="stylesheet" href="'+path+'" type="text/css" media="'+(media||"all")+'" />');},msg:function(str){for(var i=1,len=arguments.length;i<len;++i){str=str.replace("{"+(i-1)+"}",arguments[i]);}
return str;},msgAll:function(str){for(var i=1,len=arguments.length;i<len;++i){str=str.replace(new RegExp("\\{"+(i-1)+"\\}","g"),arguments[i]);}
return str;},numeric:function(string){string=string.replace(/[^0-9]/gi,'');if(!string||isNaN(string)){string=0;}
return string;},open:function(node){if(node.href)window.open(node.href);return false;},preventDefault:function(e){e.preventDefault();},processLoadQueue:function(){if(Core.deferredLoadQueue.length>0){for(var i=0,path;path=Core.deferredLoadQueue[i];i++){Core.load(path);}}},randomNumber:function(no){return Math.floor(Math.random()*no);},scrollTo:function(target,duration,callback){target=$(target);if(target.length!==1){return;}
var win=$(window),winTop=win.scrollTop(),winBottom=winTop+win.height(),top=target.offset().top;top-=15;if(top>=winTop&&top<=winBottom){return;}
if(typeof $.browser!=='undefined'){$($.browser.webkit?'body':'html').animate({scrollTop:top},duration||350,callback||null);}},scrollToVisible:function(target,duration,callback){target=$(target);if(target.length!==1){return;}
var win=$(window),winTop=win.scrollTop(),winBottom=winTop+win.height(),top=target.offset().top,bottom=top+target.height();top-=15;bottom+=15;if(top>=winTop&&bottom<=winBottom){return;}
if(typeof $.browser!=='undefined'){$($.browser.webkit?'body':'html').animate({scrollTop:(top<winTop?top:bottom-win.height())},duration||350,callback||null);}},stopEvent:function(e){e.stop();},stopPropagation:function(e){e.stopPropagation();},trimChar:function(string,c){if(string.substr(0,1)===c)string=string.substr(1,(string.length-1));if(string.substr((string.length-1),string.length)===c)string=string.substr(0,(string.length-1));return string;},trimRight:function(string,charlist){charlist=!charlist?' \\s\u00A0':(charlist+'').replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,'\\$1');return(string+'').replace(new RegExp('['+charlist+']+$','g'),'');},ui:function(context){context=context||document;if(Core.isIE(6)){$(context).find('button.ui-button').hover(function(){if(!this.disabled||this.className.indexOf('disabled')==-1){$(this).addClass('hover');}},function(){$(this).removeClass('hover');});}
if(Core.project!=='bam'){$(context).find('button.ui-button').click(function(e){var self=$(this);var alt=self.attr('data-text');if(typeof alt==='undefined'){alt="";}
if(this.tagName.toLowerCase()==='button'&&alt!==""){if(self.attr('type')==='submit'){e.preventDefault();e.stopPropagation();self.find('span span').html(alt);self.removeClass('hover').addClass('processing').attr('disabled','disabled');self.parents('form').submit();}}
return true;});}},zeroFill:function(number,width,includeDecimal){if(typeof includeDecimal==='undefined'){includeDecimal=false;}
var result=parseFloat(number),negative=false,length=width-result.toString().length,i=length-1;if(result<0){result=Math.abs(result);negative=true;length++;i=length-1;}
if(width>0){if(result.toString().indexOf('.')>0){if(!includeDecimal){length+=result.toString().split('.')[1].length;}
length++;i=length-1;}
if(i>=0){do{result='0'+result;}while(i--);}}
if(negative){return'-'+result;}
return result;},trackEvent:function(eventCategory,eventAction,eventLabel){window._gaq=_gaq||[];_gaq.push(['_trackEvent',eventCategory,eventAction,eventLabel]);},bindTrackEvent:function(selector,eventCategory,eventAction,eventLabel){$(selector).on('click.analytics',function(){var self=$(this);var submitCategory,submitAction,submitLabel;if(typeof eventCategory=="function"){submitCategory=eventCategory.call(this);}else{submitCategory=eventCategory;}
if(typeof eventLabel=="function"){submitLabel=eventLabel.call(this);}else{submitLabel=eventLabel;}
if(typeof eventAction=="function"){var eventActionToken=self.data('action-attachment')||"Unknown Action";submitAction=eventAction.call(this,eventActionToken);}else{submitAction=eventAction;}
submitCategory=self.data('category')||submitCategory||Core.project;submitAction=self.data('action')||submitAction||"Click";submitLabel=self.data('label')||submitLabel||Core.locale;Core.trackEvent(submitCategory,submitAction,submitLabel);});},showUntilClosed:function(nodeQuery,cookieId,options){options=options||{};var node=$(nodeQuery),COOKIE_NAME='bnet.closed.'+cookieId;if(!node.length||!Cookie.isSupported()||Cookie.read(COOKIE_NAME)){return false;}
var now=new Date();if(options.startDate){var startDate=new Date(options.startDate);if((startDate-now)>0){return false;}}
if(options.endDate){var endDate=new Date(options.endDate);if((endDate-now)<0){return false;}}
if(options.fadeIn){node.fadeIn(options.fadeIn,options.onShow);}else{node.show();if(options.onShow){options.onShow();}}
var cookieParams=$.extend({path:Core.baseUrl,expires:8760},options.cookieParams||{});node.delegate('a','click',function(){var self=$(this),trackingLabel=self.data('label'),closeButton=(this.rel==='close');if(closeButton){node.hide();if(options.onHide){options.onHide();}}
if(closeButton||!options.closeButtonOnly){Cookie.create(COOKIE_NAME,1,cookieParams);}
if(trackingLabel){Marketing.trackImpression(options.trackingCategory||'Tracking',options.trackingAction||'Click',trackingLabel);}});return true;}};$(function(){Core.initialize();});var Feedback={form:null,ID_MAP:{'url':'feedback-page-url','email':'feedback-email','subject':'feedback-subject','body':'feedback-body'},overlayInstance:null,pageErrorMsg:'',pageReferring:'',feedbackUrl:'',initialize:function(){if($('#feedback-page').length){return;}
this.feedbackUrl='/'+Core.locale+'/feedback/';var $feedbackSuggestionLinks=$('.feedback-suggestion-open'),$feedbackErrorLinks=$('.feedback-error-open'),self=this;$feedbackSuggestionLinks.each(function(){this.onclick=function(){self.open('suggestion');return false;};});$feedbackErrorLinks.each(function(){this.onclick=function(){self.open('bug');return false;};});this.overlayInstance=Overlay;},open:function(type){var self=this;self.overlayInstance.open(self.feedbackUrl+'feedback-form.frag',{ajax:true,className:'feedback-overlay',bindClose:false});$('#overlay').unbind('overlayLoaded');$('#overlay').bind('overlayLoaded',function(){var overlayWrapper=$(self.overlayInstance.wrapper);self.overlayInstance.position();overlayWrapper.css('position','absolute');if(parseInt(overlayWrapper.css('top'),10)<0){overlayWrapper.css('top',0);}
self.form=document.getElementById('website-feedback');var $headline=$('.feedback-wrapper h2'),$introText=$('#feedback-intro-message'),submitBtn=document.getElementById('feedback-submit'),subjectField=document.getElementById('feedback-subject'),pageUrlField=document.getElementById('feedback-page-url'),pageUrlSystemField=document.getElementById('page-url-system'),$bodyLabel=$('.feedback-body-label #body-label-text'),bodyField=document.getElementById('feedback-body'),charCount=document.getElementById('feedback-body-char-count'),$charCount=$(charCount),maxCount=bodyField.getAttribute('maxlength');$('.overlay-close').unbind('click').bind('click',function(e){e.preventDefault();self.cancel();});if(type==='suggestion'){$headline.html(Feedback.titleWebsiteSuggestion);$introText.html(Feedback.introFeedback);}else{$headline.html(Feedback.titleWebsiteFeedback);$introText.html(Feedback.introError);$bodyLabel.html(Feedback.feedbackError);}
self.form.setAttribute('action',self.feedbackUrl+type);subjectField.value=self.pageErrorMsg;pageUrlField.value=self.pageReferring;pageUrlSystemField.value=self.pageReferring;$(pageUrlField).focus();$('#blackout').bind('click.feedback',function(e){$(pageUrlField).focus();});$(pageUrlField).keydown(function(e){if(e.which===9&&e.shiftKey){e.preventDefault();$(cancelBtn).focus();}});submitBtn.onclick=function(){if(!self.submit()){return false;}};charCount.parentNode.style.display='block';charCount.firstChild.nodeValue=maxCount;bodyField.onkeyup=function(){if(this.value.length>maxCount){$(this).addClass('.feedback-error');$charCount.addClass('error');}else{$charCount.removeClass('error');}
$charCount.html(maxCount-this.value.length);};});},submit:function(){var submitUrl=this.form.getAttribute('action'),emailField=document.getElementById('feedback-email'),charCount=document.getElementById('feedback-body-char-count'),feedbackBody=document.getElementById('feedback-body'),$introText=$('#feedback-intro-message'),self=this;$('.feedback-error').each(function(){var $this=$(this);$this.removeClass('feedback-error');if($this.attr('id')!=='feedback-body-char-count'){$this.next('.feedback-error-msg').hide();}
$(charCount).removeClass('error');});if(feedbackBody.value.length>(feedbackBody.hasAttribute('maxlength')?feedbackBody.getAttribute('maxlength'):2000)){$(feedbackBody).addClass('feedback-error');$(charCount).addClass('error');}
var $requiredFields=$('.feedback-required',this.form);$requiredFields.each(function(){var $el=$(this);if(($el.val()===null)||($.trim($el.val())==='')){$el.addClass('feedback-error');$el.next('.feedback-error-msg').show();}});if($('.feedback-error').length===0){var serializedForm=$(self.form).serializeArray();if($.trim(emailField.value)===''){for(var i=0,iLen=serializedForm.length;i<iLen;i+=1){if(serializedForm[i].name==='email'){serializedForm[i].value='no_email_given@blizzard.com';}}}
$.ajax({type:'POST',url:submitUrl,data:serializedForm,success:function(){var successMsg=document.getElementById('feedback-success'),closeBtn=document.getElementById('feedback-close');self.form.style.display='none';successMsg.style.display='block';$introText.hide();closeBtn.onclick=function(){self.cancel();};},error:function(data){var response;try{response=JSON.parse(data.responseText);if(response){$.each(response.fieldErrors,function(key,val){$('#'+self.ID_MAP[key]).addClass('feedback-error').next('.feedback-error-msg').show();});return false;}else{throw"Invalid response";}}catch(e){var failMsg=document.getElementById('feedback-fail'),failCloseBtn=document.getElementById('feedback-fail-close');self.form.style.display='none';failMsg.style.display='block';failCloseBtn.onclick=function(){self.cancel();};return false;}}});return false;}else{}},cancel:function(){$('.feedback-wrapper').remove();$('#blackout').unbind('click.feedback');this.overlayInstance.close();this.overlayInstance.cache={};return false;}};var Filter={query:{},timers:{},initialize:function(callback){var total=0;if(location.hash){var hash=Core.getHash();if(hash!=='reset'){var params=hash.split('&'),parts;for(var i=0,length=params.length;i<length;++i){parts=params[i].split('=');Filter.query[parts[0]]=decodeURIComponent(parts[1])||'null';total++;}}}
Filter.uiSetup(true);if(Core.isCallback(callback)){callback(Filter.query,total);}},addParam:function(key,value){if(key){if(!value||value===""){Filter.deleteParam(key);}else{Filter.query[key]=value;}}},appendRangeData:function(self,value){var range={};if(typeof self.data('min')!=='undefined'){range={min:parseInt(value,10),max:parseInt(self.siblings('input[data-max]').val(),10),base:self.data('min'),type:'min'};}else{range={min:parseInt(self.siblings('input[data-min]').val(),10),max:parseInt(value,10),base:self.data('max'),type:'max'};}
return range;},applyQuery:function(){var hash=[];if(Filter.query){for(var key in Filter.query){if(Filter.query[key]!==null&&Filter.query.hasOwnProperty(key)){hash.push(key+'='+encodeURIComponent(Filter.query[key]));}}}
if(hash.length>0){location.replace('#'+hash.join('&'));}else{Filter.reset();}},bindInputs:function(target,callback){$(target).find('[data-filter]').each(function(){var self=$(this),data=Filter.extractData(self);if(data.field==='text'||data.field==='textarea'){self.keyup(function(){data.value=self.val();if(data.filter==='range'){data.range=Filter.appendRangeData(self,data.value);}
Filter.setTimer(data.name,data,callback);});}else if(data.field==='a'){self.click(function(){data.value=self.data('value');callback(data);});}else{self.change(function(){var value=(typeof self.data('value')!=='undefined')?self.data('value'):'';if(data.field==='checkbox'){data.value=self.is(':checked')?(value||'true'):'';}else{data.value=value||self.val();}
callback(data);});}});},defaultApply:function(query,total){if(total>0){$.each(query,function(key,value){var input=$("#filter-"+key);if(!input.length){return;}
if(input.is(':checkbox')&&value==='true'){input.prop('checked',true);}else{input.val(value);}});}},deleteParam:function(key){Filter.query[key]=null;},extractData:function(el){var node=$(el),nodeName=node.prop('nodeName').toLowerCase();return{tag:nodeName,node:node,name:(typeof node.data('name')!=='undefined')?node.data('name'):node.attr('id').replace('filter-',''),filter:node.data('filter'),column:node.data('column'),field:(nodeName==='input')?node.attr('type'):nodeName,value:''};},getParam:function(key){return Filter.query[key]||null;},reset:function(){Filter.query={};Filter.timers={};location.replace('#reset');},resetInputs:function(target){if(!target){return;}
$(target).find('input, select, textarea').each(function(){var self=$(this),value;if((value=self.data('min'))!=='undefined'){self.val(value);}else if((value=self.data('max'))!=='undefined'){self.val(value);}else if((value=self.data('default'))!=='undefined'){self.val(value);}else{self.val('');}
self.removeClass('active').removeAttr('checked');if(this.tagName.toLowerCase()==='input'&&(this.type==='checkbox'||this.type==='radio')){this.checked=false;}});},setTimer:function(key,data,callback){if(Filter.timers[key]!==null){window.clearTimeout(Filter.timers[key]);Filter.timers[key]=null;}
Filter.timers[key]=window.setTimeout(function(){callback(data);},350);},applyReset:false,uiClick:function(e){var input=$(e.currentTarget||e.target),view=input.siblings('.view'),reset=input.siblings('.reset');if(input.val()!==''){view.hide();reset.show();}else{view.show();reset.hide();}},uiReset:function(e){var reset=$(e.currentTarget||e.target),view=reset.siblings('.view'),input=reset.siblings('.input');view.show();reset.hide();input.trigger('reset');if(Filter.applyReset){var data=Filter.extractData(input);Filter.deleteParam(data.name);Filter.applyQuery();}},uiSetup:function(reset){var ui=$('.ui-filter');if(ui.length){ui.find('.reset').click(Filter.uiReset);ui.find('.input').bind({keyup:Filter.uiClick,focus:Input.activate,blue:Input.reset,reset:function(){$(this).val('').trigger('keyup').trigger('blur');}});}
Filter.applyReset=reset;}};var Flash={videoPlayer:'',videoBase:'',ratingImage:'',expressInstall:'expressInstall.swf',requiredVersion:'10.2.154',initialize:function(){Flash.defaultVideoFlashVars.ratingPath=Flash.ratingImage;Flash.defaultVideoFlashVars.locale=Core.locale;Flash.defaultVideoFlashVars.dateFormat=Core.shortDateFormat;},defaultVideoParams:{allowFullScreen:"true",bgcolor:"#000000",allowScriptAccess:"always",wmode:"opaque",menu:"false"},defaultVideoFlashVars:{ratingFadeTime:"1",ratingShowTime:"4",autoPlay:true},getFlashError:function(){var errorDiv=$("<div id=\"flash-error\" class=\"align-center\" />");errorDiv.append("<h3 class=\"subheader\">"+Msg.ui.flashErrorHeader+"</h3>"+"<p><a href=\""+Msg.ui.flashErrorUrl+"\">"+Msg.ui.flashErrorText+"</a></p>");return errorDiv;}};$(function(){Flash.initialize();});var Hash={base:'aZbYcXdWeVfUgThSiRjQkPlOmNnMoLpKqJrIsHtGuFvEwDxCyBzA0123456789+/',delimiter:'!',empty:'.',batch:function(data){var hashes=[];for(var i=0,l=data.length;i<l;i++){hashes.push(Hash.encode(data[i]));}
return Core.trimRight(hashes.join(Hash.delimiter),Hash.delimiter);},encode:function(data,useEmpty){var hash='',base=Hash.base,empty=Hash.empty;for(var i=0,l=data.length;i<l;i++){if(data[i]!==null){hash+=base.charAt(data[i]);}else if(useEmpty){hash+=empty;}}
return Core.trimRight(hash,empty);},decode:function(data){var array=[],base=Hash.base,empty=Hash.empty;for(var i=0,l=data.length,v;i<l;i++){v=data.charAt(i);v=(v===empty)?null:base.indexOf(v);array.push(v);}
return array;}};var History={enabled:(window.history.pushState),hashbangs:{},log:[],hashChangeCallback:null,popStateCallback:null,initialize:function(){window.onhashchange=History.onHashChange;window.onpopstate=History.onPopState;},lookup:function(index){return History.log[index]||History.log;},flush:function(){History.log=[];},isHashbang:function(){return(Core.getHash().charAt(0)==='!');},push:function(state,url){state=History.packageState(state);History.log.push([state,url]);if(History.enabled){window.history.pushState(state,document.title,url);}else{History.updateHash(state,url);}},replace:function(state,url){state=History.packageState(state,true);History.log[History.log.length-1]=[state,url];if(History.enabled){window.history.replaceState(state,document.title,url);}else{History.updateHash(state,url);}},updateHash:function(state,url){if(url.indexOf('#')!==-1){url=url.split('#')[0];}
if(url.charAt(0)!=='/'){url='/'+url;}
url='!'+url.replace('?','');location.hash=url;History.hashbangs[url]=state;},packageState:function(state,replacing){if(replacing){state.logIndex=History.log.length;}else{state.logIndex=History.log.length+1;}
state.replacedState=(replacing===true);state.pageTitle=document.title;state.currentHash=location.hash;state.absoluteUrl=location.href;state.isHashbang=!History.enabled;return state;},onHashChange:function(e){if(Core.isCallback(History.hashChangeCallback)){var state=History.hashbangs[Core.getHash()]||null;History.hashChangeCallback(e,state);}},onPopState:function(e){if(Core.isCallback(History.popStateCallback)){History.popStateCallback(e);}}};$(function(){History.initialize();});var Input={initialize:function(){Input.bind('#search-field');},bind:function(target){Input.reset(target);var field=$(target);field.focus(Input.activate).blur(Input.reset);field.closest('form').submit(function(){return Input.submit(field);});},activate:function(e){var node=(typeof e==='string')?$(e):$(this);if(!node.length){return;}
if(node.val()===node.attr('alt')){node.val("");}
node.addClass("active");},reset:function(e){var node=(typeof e==='string')?$(e):$(this);if(!node.length){return;}
if(node.val()===""){node.removeClass("active").val(node.attr('alt'));}else if(node.val()!==node.attr('alt')){node.addClass("active")}},submit:function(node){node=$(node||this);if(node.val()===node.attr('alt')){node.val("");}
return true;}};$(function(){Input.initialize();});var KeyCode={backspace:8,enter:13,esc:27,space:32,tab:9,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,map:{global:{numbers:[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105],letters:[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],controls:[8,9,13,16,17,18,20,27,33,32,34,35,36,45,46,144],functions:[112,113,114,115,116,117,118,119,120,121,122,123],arrows:[37,38,39,40],os:[17,91,92,93,219,224]},de:{letters:[59,192,219,222]},es:{letters:[59,192]},ru:{letters:[59,188,190,192,219,221,222]},fr:{letters:[191]}},arrows:function(lang){return KeyCode.get('arrows',lang);},controls:function(lang){return KeyCode.get('controls',lang);},functions:function(lang){return KeyCode.get('functions',lang);},get:function(type,lang){lang=lang||Core.getLanguage();var map=[],types=[];if(typeof type==='string'){types=[type];}else{types=type;}
for(var i=0,l=types.length;i<l;++i){var t=types[i];if(!KeyCode.map.global[t]){continue;}
map=map.concat(KeyCode.map.global[t]);if(KeyCode.map[lang]&&KeyCode.map[lang][t]){map=map.concat(KeyCode.map[lang][t]);}}
return map;},isAlpha:function(e,lang){return($.inArray(e.which,KeyCode.get(['letters','controls'],lang))>=0);},isAlnum:function(e,lang){return(KeyCode.isAlpha(e,lang)||KeyCode.isNumeric(e,lang));},isNumeric:function(e,lang){return($.inArray(e.which,KeyCode.get(['numbers','controls'],lang))>=0)&&!e.shiftKey;},letters:function(lang){return KeyCode.get('letters',lang);},numbers:function(lang){return KeyCode.get('numbers',lang);}};var Locale={dataPath:'/fragment/i18n.frag',initialize:function(){var path=location.pathname.replace(Core.baseUrl,"");path=path+(location.search||'?');$('#change-language, #service .service-language a').click(function(){return Locale.openMenu('#change-language',encodeURIComponent(path));});},openMenu:function(toggler,path){var node=$('#international');toggler=$(toggler);path=path||'';if(node.is(':visible')){node.slideUp();toggler.toggleClass('open');}else{if(node.html()!==""){Locale.display();toggler.toggleClass('open');}else{$.ajax({url:Locale.dataPath+'?path='+path,dataType:'html',success:function(data){if(data){node.replaceWith(data);toggler.toggleClass('open');Locale.display();}}});}}
return false;},trackEvent:function(eventAction,eventLabel){try{_gaq.push(['_trackEvent','Battle.net Language Change Event',eventAction,eventLabel]);}catch(e){}},display:function(){var node=$('#international');node.slideDown('fast',function(){$(this).css('display','block');});if(typeof $.browser==='undefined'||!$.browser.opera){$('html, body').animate({scrollTop:node.offset().top},1000);}}};$(function(){Locale.initialize();});var Login={CONTAINER_ID:"login-embedded",FADE_DURATION:"slow",embeddedUrl:"/login/login.frag",success:function(token){$('<div/>',{id:'embedded-loader'}).appendTo('body');window.setTimeout(function(){var delim=window.location.search?"&":"?";if(window.location.hash.length===0){window.location=window.location+delim+"ST="+token;}else{var url=window.location.href.substring(0,window.location.href.length-window.location.hash.length);window.location=url+delim+"ST="+token+"&ST-frag="+window.location.hash.substring(1);}},100);},open:function(url,legacyHref,legacyReferrer){url=url||Login.embeddedUrl;Login._timeTracker.start();var nSep=(url.indexOf('?')===-1)?'?':'&';if("https:"===document.location.protocol){url+=nSep;url+="secureOrigin=true";nSep='&';}
if(url.indexOf('?loc=')===-1||url.indexOf("&loc=")===-1){url+=nSep+"loc="+Core.getLanguage();nSep='&';}
if(url.indexOf('?ref=')===-1||url.indexOf('&ref=')===-1){url+=nSep+"ref="+encodeURIComponent(window.location);nSep='&';}
if(document.getElementById(Login.CONTAINER_ID)){return false;}
if((typeof postMessage!=="object"&&typeof postMessage!=="function")||typeof JSON!=="object"){if(legacyHref){var delim=(legacyReferrer.indexOf("?")===-1)?"?":"&";document.location=legacyHref+encodeURIComponent(legacyReferrer+delim+"ST-frag="+encodeURIComponent(Core.getHash()));return false;}
return true;}
var container=$("<div/>",{id:Login.CONTAINER_ID});container.append($("<iframe/>",{src:url,frameborder:0})).css("visibility","hidden");if(Core.isIE()){$(window).resize(function(){var doc=$(document);$('#blackout').css({width:doc.width(),height:doc.height()});});}
container.appendTo("body");Blackout.show(null,function(){Blackout.hide();Login._close();});Login._setListener();Login._timeoutHandler.activate();return false;},openOrRedirect:function(url,legacyHref,legacyReferrer){if(Login.open(url,legacyHref,legacyReferrer)){var href=location.href,delim=(href.indexOf("?")===-1)?"?":"&";location.href=href+delim+'login=true&cr=true';}},_close:function(removeBlackout){Login._removeListener();removeBlackout=removeBlackout||false;$("#"+Login.CONTAINER_ID).fadeOut(Login.FADE_DURATION,function(){$(this).remove();if(removeBlackout){Blackout.hide();}});Login._timeoutHandler.deactivate();},_messageListener:function(event){var data=JSON.parse(event.data);switch(data.action){case"onload":Login._timeoutHandler.deactivate();Login._timeTracker.end();var node=$('#'+Login.CONTAINER_ID),embed=$('#'+Login.CONTAINER_ID+' iframe');node.css('height',data.height);embed.css('height',data.height);if(data.height>500){node.css('margin-top',-(data.height/2));node.css('margin-bottom',-(data.height/2));}
node.css("visibility","visible");break;case"success":Login._close();Login.success(data.loginTicket);break;case"close":Login._close(true);break;case"redirect":window.location=data.url+"?ref="+encodeURIComponent(window.location);break;}},_setListener:function(){Login._removeListener();Login._listener=function(event){Login._messageListener(event);};if(typeof addEventListener!=="undefined"){addEventListener("message",Login._listener,false);}else{attachEvent("onmessage",Login._listener);}},_removeListener:function(){if(!Login._listener){return;}
if(typeof removeEventListener!=="undefined"){removeEventListener("message",Login._listener,false);}else{detachEvent("onmessage",Login._listener);}},_timeTracker:{startTime:null,start:function(){this.startTime=new Date().getTime();},end:function(){_gaq.push(["_trackEvent","debug","login frag load time",""+Math.round(((new Date().getTime())-this.startTime)/500)*500]);}},_timeoutHandler:{timeoutMs:5000,timeoutVar:null,loaderVar:null,activate:function(){this.loaderVar=$("<div/>",{id:"embedded-loader"}).appendTo("body");this.timeoutVar=window.setTimeout(function(){Login._timeoutHandler.handleTimeout();},this.timeoutMs);},deactivate:function(){this.loaderVar.remove();window.clearTimeout(this.timeoutVar);this.timeoutVar=null;},handleTimeout:function(){_gaq.push(["_trackEvent","debug","login frag timeout",""+this.timeoutMs]);window.location="/?login";}}}
var Marketing={bindTracking:function(query,category,action){$(query).click(function(){var self=$(this);try{_gaq.push(['_trackEvent',self.data('category')||category,self.data('action')||action,self.data('ad')+' ['+Core.locale+']']);}catch(e){}});},trackActivity:function(module,label){try{_gaq.push(['_trackEvent','Battle.net User Activity',module,label+' ['+Core.locale+']']);}catch(e){}},trackAd:function(id,title,ref,clickEvent){try{ref=ref?ref+' - ':'';_gaq.push(['_trackEvent','Battle.net Ad Service',(clickEvent)?'Ad Click-Throughs':'Ad Impressions','Ad '+encodeURIComponent(title.replace(' ','_'))+' - '+ref+Core.locale+' - '+id]);}catch(e){}},trackImpression:function(category,action,label){try{_gaq.push(['_trackEvent',category,action,label+' ['+Core.locale+']']);}catch(e){}}};var Menu={data:{},dataIndex:{},container:null,node:null,idName:'menu-tier',className:'flyout-menu',timer:null,timers:{},openTimer:null,children:{},config:{},initialize:function(url,config){Menu.config=$.extend({},{duration:750,dataUrl:{},colWidth:200,colMax:15},config);Menu.container=$('<div/>').attr('id','menu-container').appendTo('body');Menu.container.unbind().mouseleave(function(){Menu.timer=window.setTimeout(function(){Menu.hide();},Menu.config.duration);}).mouseenter(function(){window.clearTimeout(Menu.timer);});if(!url){return false;}
Menu.load('base',url);$('.ui-breadcrumb li a').each(function(key,crumb){var anchor=$(crumb),url=anchor.attr('href').replace(Core.baseUrl,'');anchor.mouseover(function(){Menu.show(this,url);});});},hide:function(){window.clearTimeout(Menu.timer);window.clearTimeout(Menu.openTimer);Menu.container.find('div').hide();if(Menu.node){Menu.node.removeClass('opened');Menu.node=null;}},hideChild:function(url){if(!Menu.children[url]){return;}
Menu.children[url].children('a:first, span:first').removeClass('opened').end().children('.'+Menu.className).hide();},load:function(set,url){if(Menu.data[set]){return;}
$.ajax({url:Core.baseUrl+url,dataType:'json',success:function(data){Menu.data[set]=data;Menu.dataIndex[set]={};Menu._populate(data,set);var anchors=$('.ui-breadcrumb li a'),length=anchors.length-1;anchors.each(function(i){var self=$(this),url=self.attr('href').replace(Core.baseUrl,''),idx=Menu.dataIndex[set][url];if(idx){if(idx.children&&length===i){self.parent().addClass('children');}
if(!idx.children){self.parent().addClass('childless');}}});}});Menu.config.dataUrl[set]=url;},open:function(node,path,options){options=$.extend({},{set:'base'},options||{});Menu.node=$(node);var data=Menu.dataIndex[options.set][path]||null;if(data&&data.children){if($('#'+Menu._id(path,options.set)).is(':visible')){Menu.hide();}else{Menu._display(path,options);}}},show:function(node,path,options){options=$.extend({},{set:'base'},options||{});if(!Menu.dataIndex[options.set][path]){return;}
if($('#'+Menu._id(path,options.set)).is(':visible')){return;}
Menu.hide();Menu.node=$(node);Menu.openTimer=window.setTimeout(function(){Menu._display(path,options);},200);Menu.node.unbind('mouseleave mouseenter').mouseleave(function(){window.clearTimeout(Menu.openTimer);Menu.timer=window.setTimeout(function(){Menu.hide();},Menu.config.duration);}).mouseenter(function(){window.clearTimeout(Menu.timer);});},_build:function(parent,menu,cache){var div=$('<div>').addClass(Menu.className),uls=[];if(cache){div.attr('id',cache);}
$.each(menu.children,function(key,data){var tag=(data.url)?'a':'span',li=$('<li/>'),item=$('<'+tag+'/>',Menu._prepare(data)).appendTo(li);if(data.description){item.append('<span class="desc">'+data.description+'</span>');}
if(data.parentClass){li.addClass(data.parentClass);}
if(data.children){item.addClass('children').append('<span class="child-arrow"></span>');}
li.hover(function(){Menu.hideChild(menu.url);if(data.children){var self=$(this);self.children('a:first, span:first').addClass('opened');if(self.find('.'+Menu.className).length===0){Menu._build(this,data,false);}
Menu._position(self.children('.'+Menu.className));Menu.children[menu.url]=self;window.clearTimeout(Menu.timers[menu.url]);}},function(){if(data.children){Menu.timers[menu.url]=window.setTimeout(function(){Menu.hideChild(menu.url);},Menu.config.duration);}});var index=Math.ceil((key+1)/Menu.config.colMax)-1;if(menu.children.length<=(Menu.config.colMax+3)){index=0;}
if(!uls[index]){uls[index]=$('<ul/>');}
li.appendTo(uls[index]);});for(var i=0;i<=(uls.length-1);++i){$(uls[i]).appendTo(div);}
if(uls.length>1){div.css('width',(uls.length*Menu.config.colWidth));}
div.appendTo(parent);},_display:function(path,options){if(!Menu.dataIndex[options.set][path]){return;}
var data=Menu.dataIndex[options.set][path],center=(options.center)||(options===true),id=Menu._id(path,options.set);if(data&&data.children){var targetMenu=$('#'+id);if(targetMenu.length>0){targetMenu.fadeIn('fast');}else{Menu._build(Menu.container,data,id);}
Menu.node.addClass('opened');var nodeOffset=Menu.node.parent().offset(),nodeWidth=Menu.node.parent().width(),x=nodeOffset.left,y=nodeOffset.top+Menu.node.outerHeight(false),opts={top:y+'px',position:'absolute',visibility:'visible',zIndex:'75'};if(center){var width=Math.round(nodeWidth/2)-Math.round(Menu.config.colWidth/2);opts.left=(x+width)+'px';}else{opts.left=x+'px';}
Menu.container.css(opts).show();}},_id:function(path,set){var id=Menu.idName+'-'+set;if(Menu.dataIndex[set][path].id){id+=Menu.dataIndex[set][path].id;}
return id;},_position:function(element){element.show();if(element.find('ul').length<=1){var offset=element.offset(),width=element.outerWidth(false),x=offset.left+width;if(x>=Page.dimensions.width){element.css('left',-width);}}},_populate:function(node,set){if(!Menu.dataIndex[set][node.url]){node.id=(node.url?node.url.replace(/[^\-a-zA-Z0-9\/]/ig,''):'');node.id=node.id.replace(/\//ig,'-');if(node.id.substr(-1)==='-'){node.id=node.id.substr(0,(node.id.length-1));}
Menu.dataIndex[set][node.url]=node;}
if(node.children){for(var i=0,child;child=node.children[i];i++){Menu._populate(child,set);}}},_prepare:function(obj){var label=obj.label||'',mapping={html:label.replace(/&/ig,'&amp;'),rel:'np'},params={};if(obj.url!==null){mapping.href=Core.baseUrl+obj.url;}
$.each(mapping,function(key,value){if(value){params[key]=value;}});return params;}};var Overlay={cache:{},config:{ajax:false,bindClose:true,className:"",fadeSpeed:250,blackout:true},loaded:null,wrapper:null,initialize:function(){if(Overlay.loaded&&Overlay.wrapper)return;Overlay.wrapper=$('<div/>',{id:'overlay','class':'ui-overlay'}).appendTo('body').hide();$('<a/>').addClass('overlay-close').attr('href','javascript:;').click(Overlay.close).appendTo(Overlay.wrapper);var top=$('<div/>').addClass('overlay-top').appendTo(Overlay.wrapper);var bot=$('<div/>').addClass('overlay-bottom').appendTo(top);var mid=$('<div/>').addClass('overlay-middle').appendTo(bot);Overlay.loaded=true;},close:function(speed){speed=!speed?10:(speed||250);$("#blackout").fadeOut(speed);Overlay.wrapper.fadeOut(speed,function(){Overlay.setContent("");Overlay.wrapper.attr('class','ui-overlay');if(Overlay.wrapper.attr('id')!=='overlay'){Overlay.wrapper.hide();}});},open:function(content,config){Overlay.initialize();config=$.extend({},Overlay.config,config);if(config.className){Overlay.wrapper.addClass(config.className);}
if(config.blackout){if(config.bindClose){Blackout.show(null,function(){Overlay.close(config.fadeSpeed);});}else{Blackout.show();}}
if(config.ajax){if(Overlay.cache[content]){Overlay.show(Overlay.cache[content]);$('#overlay').trigger('overlayLoaded');}else{$.ajax({type:"GET",url:content,dataType:"html",beforeSend:function(){Overlay.reset();Overlay.show();},success:function(data,status){Overlay.cache[content]=data;Overlay.setContent(data);$('#overlay').trigger('overlayLoaded');}});}}else if(content.substr(0,1)==='#'){Overlay.show($(content).html());}else{Overlay.show(content);}},openCustom:function(element,config){Overlay.wrapper=$(element);if(Overlay.wrapper){config=$.extend({},Overlay.config,config);if(config.blackout){if(config.bindClose){Blackout.show(null,function(){Overlay.close(config.fadeSpeed);});}else{Blackout.show();}}
Overlay.position();}},position:function(node){node=node||Overlay.wrapper;var width=node.outerWidth(false),height=node.outerHeight(false),x=(Page.dimensions.width/2)-(width/2),y=(Page.dimensions.height/2)-(height/2);if(Core.isIE(6)){y=Page.scroll.top+y;}
node.show().css({left:x+'px',top:y+'px',position:Core.isIE(6)?'absolute':'fixed'});},reset:function(){Overlay.wrapper.find('.overlay-middle').html("").addClass('overlay-loading');},show:function(content){Overlay.setContent(content);Overlay.position();},setContent:function(content){if(content!=null){if(content===''){Overlay.wrapper.find('overlay-middle').empty();}else{Overlay.wrapper.find('.overlay-middle').html(content);}}}};var Page={object:null,loaded:false,dimensions:{width:0,height:0},scroll:{top:0,width:0},initialize:function(){if(Page.loaded){return;}
if(!Page.object){Page.object=$(window);}
Page.object.resize(Page.getDimensions).scroll(Page.getScrollValues);Page.getScrollValues();Page.getDimensions();Page.loaded=true;},getScrollValues:function(){Page.scroll.top=Page.object.scrollTop();Page.scroll.left=Page.object.scrollLeft();},getDimensions:function(){Page.dimensions.width=Page.object.width();Page.dimensions.height=Page.object.height();}};$(function(){Page.initialize();});var Prompt={node:null,input:null,title:null,errors:null,initialized:false,defaults:{minLength:{value:1},maxLength:{value:25},numeric:{value:false}},rules:{},callback:null,initialize:function(){Prompt.node=$('<div/>').addClass('ui-prompt').click(Core.stopPropagation).appendTo('body');var inner=$('<form/>').attr('method','post').attr('action','').addClass('prompt-inner').appendTo(Prompt.node).submit(Core.preventDefault).keyup(function(e){if(e.which===KeyCode.enter){Prompt.validate();}});Prompt.title=$('<h3/>').addClass('subheader').text('').appendTo(inner);Prompt.input=$('<input/>').addClass('input').appendTo(inner).focus(Input.activate).blur(Input.reset);Prompt.errors=$('<ul/>').addClass('prompt-errors').hide().appendTo(inner);var buttons=$('<div/>').addClass('prompt-buttons').appendTo(inner);$('<button type="button"/>').addClass('ui-button button1').html('<span class="button-left"><span class="button-right">'+Msg.ui.submit+'</span></span>').click(Prompt.validate).appendTo(buttons);$('<button type="button"/>').addClass('ui-button button1').html('<span class="button-left"><span class="button-right">'+Msg.ui.cancel+'</span></span>').click(Prompt.close).appendTo(buttons);$(document).bind('keyup.prompt',function(e){if(e.which===KeyCode.esc){Prompt.close();}});Prompt.initialized=true;},open:function(title,callback,rules){if(!Prompt.initialized){Prompt.initialize();}
var width=Prompt.node.outerWidth(false),height=Prompt.node.outerHeight(false),x=(Page.dimensions.width/2)-(width/2),y=(Page.dimensions.height/2)-(height/2)+Page.scroll.top;Prompt.rules=$.extend({},Prompt.defaults,rules||{});Prompt.callback=callback;Prompt.title.text(title);Prompt.input.attr('maxlength',Prompt.rules.maxLength.value);Prompt.node.css({top:y,left:x}).show();Blackout.show(function(){Prompt.input.focus();},Prompt.close);},close:function(){Prompt.input.val('').trigger('blur');Prompt.errors.empty().hide();Prompt.node.hide();Blackout.hide();},validate:function(){var input=Prompt.input,value=input.val().trim(),valid=true,errors=[],rule,i=0,l=0;for(var key in Prompt.rules){rule=Prompt.rules[key];valid=true;if(!rule){continue;}
if(typeof rule.value==='function'){valid=rule.value(value);}else{switch(key){case'minLength':if(rule.value&&value.length<rule.value)valid=false;break;case'maxLength':if(rule.value&&value.length>rule.value)valid=false;break;case'numeric':if(rule.value&&isNaN(value))valid=false;break;}}
if(!valid){errors.push(rule.message||key);}}
if(errors.length){Prompt.errors.empty().show();for(i=0,l=errors.length;i<l;i++){$('<li/>').text(errors[i]).appendTo(Prompt.errors);}}else{if(Core.isCallback(Prompt.callback)){Prompt.callback(value);}
Prompt.close();}}};var Search={ta:null,map:{articlekeyword:'article',blog:'article',product:'product','static':'static',friend:'friend'},initialize:function(url,searchField){var resultTypes=[];if(Core.project==='wow'){resultTypes=['friend','url','wowcharacter','wowguild','wowarenateam','wowitem','article','static','other'];Search.map.character='wowcharacter';Search.map.arenateam='wowarenateam';Search.map.guild='wowguild';Search.map.wowitem='wowitem';Search.map.item='wowitem';Search.map.friend='wowcharacter';}else{resultTypes=['friend','url','product','article','static','other','kb'];}
Search.ta=TypeAhead.factory(searchField||'#search-field',{groupResults:true,resultTypes:resultTypes,ghostQuery:(Core.region==='us'||Core.region==='eu'||Core.region==='sea'),source:function(term,display){$.ajax({url:url,data:{term:term,locale:Core.formatLocale(2,'_'),community:Core.project},cache:true,dataType:url.charAt(0)==='/'?'json':'jsonp',success:function(response){var results=[];if(response.results){for(var i=0,result;result=response.results[i];i++){var title='',resultContainer=$('<div/>').html(result.title||result.term);if(resultContainer){title=resultContainer.text();}
var data={type:Search.map[result.type]||'url',title:title,desc:'',url:'',icon:''};switch(result.type){case'character':data.desc=result.realmName;data.url=Core.baseUrl+'/character/'+result.realmName.replace(/[^a-z0-9]/ig,'-').toLowerCase()+'/'+result.term+'/';break;case'arenateam':data.desc=result.realmName;data.url=Core.baseUrl+'/arena/'+result.realmName.replace(/[^a-z0-9]/ig,'-').toLowerCase()+'/'+result.teamSize+'/'+result.term+'/';break;case'guild':data.desc=result.realmName;data.url=Core.baseUrl+'/guild/'+result.realmName.replace(/[^a-z0-9]/ig,'-').toLowerCase()+'/'+result.term+'/';break;case'wowitem':case'item':data.className='color-q'+result.rarity;data.desc=Core.msg(Msg.cms.ilvl,result.level);data.url=Core.baseUrl+'/item/'+result.objectId;if(result.context){data.url+="/"+result.context;}
break;case'url':case'static':case'product':data.desc=result.desc;data.icon=result.icon;data.url=result.url;break;case'friend':data.url=Core.projectUrl+result.url;data.icon=Core.projectUrl+result.icon;break;default:data.url='';if(result.url){data.url=$('<div/>').html(result.url).text();}
if(data.title!==result.term){data.desc=result.term||'';}
break;}
results.push(data);}}
display(results);}});}});}};var Storage={initialized:(window.localStorage),get:function(key){if(Storage.initialized&&key){return localStorage.getItem(key);}
return null;},getAll:function(prefix){var items=[];if(!Storage.initialized){return items;}
for(var i=0,l=localStorage.length,k=null;i<l;i++){k=localStorage.key(i);if(prefix&&k.indexOf(prefix)!==0){continue;}
items.push({key:k,value:localStorage[k]});}
return items;},has:function(key){return(Storage.get(key)!==null);},set:function(key,value){if(Storage.initialized&&key){try{localStorage.setItem(key,value||'');}catch(e){if(e===QUOTA_EXCEEDED_ERR){alert('Local storage quota exceeded, please clear your saved data.');}}
return true;}
return false;},clear:function(){if(Storage.initialized)localStorage.clear();},remove:function(key){if(Storage.initialized&&key)localStorage.removeItem(key);},size:function(prefix){if(prefix){return Storage.getAll(prefix).length;}
return localStorage.length||0;}};var Tickets={tag:null,summary:null,fragment:null,ul:null,doc:null,total:3,initialize:function(){Tickets.doc=document;var doc=Tickets.doc;Tickets.tag=doc.getElementById('support-ticket-count');Tickets.summary=doc.getElementById('ticket-summary');Tickets.fragment=doc.createDocumentFragment();Tickets.ul=doc.createElement('ul');Tickets.loadStatus();},updateSummary:function(json){var doc=Tickets.doc;Tickets.fragment=doc.createDocumentFragment();Tickets.ul=doc.createElement('ul');Tickets.summary.innerHTML='';Tickets.fragment.appendChild(Tickets.ul);if(json.length<1){return;}
for(var i=0,ticket;ticket=json[i];i++){Tickets.createListItem(ticket,i);}
Tickets.summary.appendChild(Tickets.fragment);},createListItem:function(ticket,index){if(typeof ticket!=='object'){return;}
var doc=Tickets.doc,css=Core.isIE(6)||Core.isIE(7)?'className':'class',msgSupport=Msg.support,msg={created:msgSupport.ticketNew,status:msgSupport.ticketStatus,viewAll:msgSupport.ticketAll,OPEN:msgSupport.ticketOpen,ANSWERED:msgSupport.ticketAnswered,RESOLVED:msgSupport.ticketResolved,CANCELED:msgSupport.ticketCanceled,ARCHIVED:msgSupport.ticketArchived,INFO:msgSupport.ticketInfo},string='',prefix='',suffix='',icon=null,li=null,a=null,span=null,br=null,datetime=null,test=-1;if(ticket.status==='OPEN'){string=msg.created.replace('{0}',Core.region.toUpperCase()+ticket.caseId);}else{string=msg.status.replace('{0}',Core.region.toUpperCase()+ticket.caseId);}
datetime=doc.createElement('span');datetime.setAttribute(css,'ticket-datetime');datetime.appendChild(doc.createTextNode(Tickets.localizeDatetime(ticket.lastUpdate)));a=doc.createElement('a');a.href=Core.secureSupportUrl+'ticket/thread/'+ticket.caseId;icon=doc.createElement('span'),icon.setAttribute(css,'icon-ticket-status');a.appendChild(icon);test=string.indexOf('{1}');if(test>0){prefix=string.substring(0,test);suffix=string.substr(test+3,string.length);span=doc.createElement('span');span.setAttribute(css,'ticket-'+ticket.status.toLowerCase());span.appendChild(doc.createTextNode(msg[ticket.status]));a.appendChild(doc.createTextNode(prefix));a.appendChild(span);a.appendChild(doc.createTextNode(suffix));}else{a.appendChild(doc.createTextNode(string));}
br=doc.createElement('br');a.appendChild(br);a.appendChild(datetime);li=doc.createElement('li');if(index===0){li.setAttribute(css,'first-ticket');}
li.appendChild(a);Tickets.ul.appendChild(li);if(index===this.total){li=doc.createElement('li');li.setAttribute(css,'view-all-tickets');a=doc.createElement('a');a.href=Core.secureSupportUrl+'ticket/status';a.appendChild(doc.createTextNode(msg['viewAll']));li.appendChild(a);Tickets.ul.appendChild(li);}},updateTotal:function(count){count=(typeof count==='number')?count:0;var css=(Core.isIE(6)||Core.isIE(7))?'className':'class';if(count>0){Tickets.tag.setAttribute(css,'open-support-tickets');Tickets.tag.innerHTML=count;}else{Tickets.tag.setAttribute(css,'no-support-tickets');Tickets.tag.innerHTML='';}},localizeDatetime:function(timestamp){var format=Core.dateTimeFormat,locale=Core.locale,datetime=null;datetime=Core.formatDatetime(format,timestamp);if(!datetime){return'';}
if(locale==='en-us'||locale==='es-mx'||locale==='zh-cn'||locale==='zh-tw'){datetime=datetime.replace('/0','/');if(datetime.substr(0,1)==='0'){datetime=datetime.substr(1);}}
if(locale==='en-us'||locale==='es-mx'){datetime=datetime.replace(' 0',' ');}
return datetime;},loadStatus:function(){if(Tickets.summary!==null){$.ajax({timeout:3000,url:Core.secureSupportUrl+'update/json',ifModified:true,global:false,dataType:'jsonp',jsonpCallback:'getStatus',data:{supportToken:supportToken},success:function(json,status){if("notmodified"!==status){Tickets.updateTotal(json.total);Tickets.updateSummary(json.details,json.total);}}});}}};$(window).on("load",function(){Tickets.initialize();});var Toast={container:null,initialized:false,max:5,options:{timer:15000,autoClose:true,onClick:null},initialize:function(){Toast.container=$('<div/>').attr('id','toast-container').show().appendTo('body');Toast.initialized=true;},create:function(content){var toast=$('<div/>').addClass('ui-toast');$('<div/>').addClass('toast-arrow').appendTo(toast);$('<div/>').addClass('toast-top').appendTo(toast);$('<div/>').addClass('toast-content').appendTo(toast).html(content);$('<div/>').addClass('toast-bot').appendTo(toast);$('<a/>').addClass('toast-close').attr('href','javascript:;').appendTo(toast).click(function(e){e.preventDefault();e.stopPropagation();if(Toast.options.fadeUse){$(this).parent('.ui-toast').fadeOut('normal',function(){$(this).remove();});}else{$(this).parent('.ui-toast').remove();}});toast.appendTo(Toast.container).css({height:toast.height()}).hide();return toast;},show:function(content,options){if(!Toast.initialized){Toast.initialize();}
Toast.truncate();var toast=Toast.create(content);options=$.extend({},Toast.options,options);if(options.autoClose){window.setTimeout(function(){toast.fadeOut('normal',function(){toast.remove();});},options.timer);}else{toast.click(function(){toast.fadeOut('normal',function(){toast.remove();});}).css('cursor','pointer');}
if(Core.isCallback(options.onClick)){toast.click(options.onClick).css('cursor','pointer');}
toast.fadeIn();},truncate:function(){var total=Toast.container.find('.ui-toast');if(total.length>Toast.max){Toast.container.find('.ui-toast:lt('+Math.round(total.length-Toast.max)+')').fadeOut();}}};var Toggle={cache:{},callback:null,timeout:800,keepOpen:false,open:function(triggerNode,activeClass,targetPath,delay){if(delay){Toggle.timeout=delay;}
Toggle.keepOpen=true;var key=Toggle.key(targetPath);for(var k in Toggle.cache){if(k!==key){Toggle.close(Toggle.cache[k].trigger,Toggle.cache[k].activeClass,Toggle.cache[k].target,0,true);}}
if(!Toggle.cache[key]){$(triggerNode).mouseleave(function(){Toggle.keepOpen=false;Toggle.close(triggerNode,activeClass,targetPath,Toggle.timeout);}).mouseenter(function(){Toggle.keepOpen=true;window.clearTimeout(Toggle.cache[key].timer);});$(targetPath).mouseleave(function(){Toggle.keepOpen=false;Toggle.close(triggerNode,activeClass,targetPath,Toggle.timeout);}).mouseenter(function(){Toggle.keepOpen=true;window.clearTimeout(Toggle.cache[key].timer);});Toggle.cache[key]={trigger:triggerNode,target:targetPath,activeClass:activeClass,key:key,timer:null};}
$(triggerNode).toggleClass(activeClass);$(targetPath).toggle();window.clearTimeout(Toggle.cache[key].timer);},close:function(triggerNode,activeClass,targetPath,delay,force){force=(typeof force==='boolean')?force:false;var key=Toggle.key(targetPath);window.clearTimeout(Toggle.cache[key].timer);Toggle.cache[key].timer=setTimeout(function(){if(Toggle.keepOpen&&!force){return;}
$(targetPath).hide();$(triggerNode).removeClass(activeClass);Toggle.triggerCallback();},delay);},key:function(targetPath){return(typeof targetPath==='string')?targetPath:'#'+$(targetPath).attr('id');},triggerCallback:function(){if(Core.isCallback(Toggle.callback))Toggle.callback();}};var Tooltip={wrapper:null,wrapperFrame:null,contentCell:null,cache:{},currentNode:null,visible:false,options:{},query:null,maxWidth:250,threshold:100,initialized:false,instances:{},factory:function(query,options){var instance=Object.create(Tooltip);instance.init(query,options);Tooltip.instances[options.key||query]=instance;return instance;},init:function(query,options){this.query=query;this.options=$.extend({},{ajax:false,mode:'hover',className:'',location:'topRight',useTable:false,showLoading:true,onShow:null,onPosition:null,context:null,margin:10},options);if(Core.project==='sc2'){this.options.useTable=true;}
options=this.options;var wrapper=$('<div/>').addClass('ui-tooltip').appendTo("body").hide();if(Core.isIE(6)){this.wrapperFrame=$('<iframe/>',{src:'javascript:"";',frameborder:0,scrolling:'no',marginwidth:0,marginheight:0}).addClass('tooltip-frame').appendTo('body');}
if(!options.useTable){this.contentCell=$('<div/>').addClass('tooltip-content').appendTo(wrapper);}else{var tooltipTable=$('<table/>',{cellspacing:0,cellpadding:0}).appendTo(wrapper);var emptyCell=$('<td/>').attr("valign","top").text(" "),emptyRow=$('<tr/>'),contentCell=emptyCell.clone();tooltipTable.append(emptyRow.clone().append(emptyCell.clone().addClass("top-left")).append(emptyCell.clone().addClass("top-center")).append(emptyCell.clone().addClass("top-right"))).append(emptyRow.clone().append(emptyCell.clone().addClass("middle-left")).append(contentCell.addClass("middle-center")).append(emptyCell.clone().addClass("middle-right"))).append(emptyRow.clone().append(emptyCell.clone().addClass("bottom-left")).append(emptyCell.clone().addClass("bottom-center")).append(emptyCell.clone().addClass("bottom-right")));this.contentCell=contentCell;}
this.wrapper=wrapper;var event=(options.mode==='click')?'click':'mouseover',callback=(typeof options.onShow==='function')?options.onShow:function(e){var node=$(e.currentTarget),content=node.data('tooltip')||node.prop('title');if(event==='click'&&this.visible){this.hide();return;}
if(content&&node.attr('rel')!=='np'){this.show(node,content,node.data('tooltip-options')||this.options);}};$(options.context||document).off(event+'.tooltip',query,$.proxy(callback,this)).on(event+'.tooltip',query,$.proxy(callback,this));this.initialized=true;},show:function(node,content,options){if(!this.initialized){if(Core.userAgent!="mobile"){Tooltip.instances.common.show(node,content,options);}
return;}
if(options===true){options={ajax:true};}
options=$.extend({},this.options,options||{});this.currentNode=node=$(node);if(options.mode!=='click'){node.unbind('mouseout.tooltip').bind('mouseout.tooltip',$.proxy(function(){this.hide();this.wrapper.removeClass(options.location).removeClass(options.className);},this));}
if(!this['_'+options.location]){options.location='topRight';}
if(options.location===this.options.location&&node.offset().left>$(window).width()/2){options.location='topLeft';}
this.wrapper.addClass(options.location);if(options.className){this.wrapper.addClass(options.className);}
if(typeof content==='object'){this._position(node,content,options);}else if(typeof content==='string'){if(options.ajax){if(this.cache[content]){this._position(node,this.cache[content],options);}else{var url=content;if(url.indexOf(Core.projectUrl)!==0){url=Core.baseUrl+content;}
if(options.showLoading){window.setTimeout($.proxy(function(){if(!this.visible&&!this.cache[content]){this._position(node,Msg.ui.loading,options);}},this),500);}
$.ajax({type:"GET",url:url,dataType:"html",global:false,success:$.proxy(function(data){this.cache[content]=data;if(this.currentNode===node){this._position(node,data,options);}},this),error:$.proxy(function(xhr){if(xhr.status!==200){this.hide();}},this)});}}else if(content.substr(0,1)==='#'){this._position(node,$(content).html(),options);}else{this._position(node,content,options);}}},hide:function(){if(this.initialized){if(Core.isIE(6)){this.wrapperFrame.hide();this.wrapper.removeAttr('style');}
this.wrapper.hide().unbind('mousemove.tooltip').removeClass(this.options.location).removeClass(this.options.className);this.currentNode=null;this.visible=false;}else{for(var key in Tooltip.instances){Tooltip.instances[key].hide();}}},move:function(x,y,w,h){this.wrapper.css("left",x+"px").css("top",y+"px").show();this.visible=true;if(Core.isIE(6)){this.wrapperFrame.css({width:w+60,height:h,left:(x-60)+"px",top:y+"px"}).fadeTo(0,0).show();this.wrapper.css('width',w);}},_position:function(node,content,options){if(typeof options.onPosition==='function'){content=options.onPosition(content);}
if(typeof content==='string'){this.contentCell.html(content);}else{this.contentCell.empty().append(content);}
var width=this.wrapper.outerWidth(false),height=this.wrapper.outerHeight(false);if(Core.isIE(6)&&width>Tooltip.maxWidth){width=Tooltip.maxWidth;}
var coords=this['_'+options.location](width,height,node);if(coords){this.move(coords.x,coords.y,width,height);}},_mouse:function(width,height,node){node.unbind('mousemove.tooltip').bind('mousemove.tooltip',$.proxy(function(e){var margin=this.options.margin;this.move((e.pageX+margin),(e.pageY+margin),width,height);},this));},_topLeft:function(width,height,node){var offset=node.offset(),x=offset.left-width,y=offset.top-height;return this._checkViewport(x,y,width,height,node);},_topCenter:function(width,height,node){var offset=node.offset(),nodeWidth=node.outerWidth(false),x=offset.left+((nodeWidth/2)-(width/2)),y=offset.top-height-5;return this._checkViewport(x,y,width,height,node);},_topRight:function(width,height,node){var offset=node.offset(),nodeWidth=node.outerWidth(false),x=offset.left+nodeWidth,y=offset.top-height;return this._checkViewport(x,y,width,height,node);},_middleLeft:function(width,height,node){var offset=node.offset(),nodeHeight=node.outerHeight(false),x=offset.left-width,y=(offset.top+(nodeHeight/2))-(height/2);return this._checkViewport(x,y,width,height,node);},_middleRight:function(width,height,node){var offset=node.offset(),nodeWidth=node.outerWidth(false),nodeHeight=node.outerHeight(false),x=offset.left+nodeWidth,y=(offset.top+(nodeHeight/2))-(height/2);return this._checkViewport(x,y,width,height,node);},_bottomLeft:function(width,height,node){var offset=node.offset(),nodeHeight=node.outerHeight(false),x=offset.left-width,y=offset.top+nodeHeight;return this._checkViewport(x,y,width,height,node);},_bottomCenter:function(width,height,node){var offset=node.offset(),nodeWidth=node.outerWidth(false),nodeHeight=node.outerHeight(false),x=offset.left+((nodeWidth/2)-(width/2)),y=offset.top+nodeHeight+5;return this._checkViewport(x,y,width,height,node);},_bottomRight:function(width,height,node){var offset=node.offset(),nodeWidth=node.outerWidth(false),nodeHeight=node.outerHeight(false),x=offset.left+nodeWidth,y=offset.top+nodeHeight;return this._checkViewport(x,y,width,height,node);},_checkViewport:function(x,y,width,height,node){var offset=node.offset(),scroll=Page.scroll,dims=Page.dimensions,margin=this.options.margin;if((x+width)>dims.width){x=dims.width-width;}
if(x<0){x=margin;}
if((y+height)>(scroll.top+dims.height)){y=y-((y+height)-(scroll.top+dims.height));}else if((offset.top-Tooltip.threshold)<scroll.top){y=offset.top+node.outerHeight(false);}else if(y<scroll.top){y=scroll.top+margin;}
if(y<0){y=margin;}
return{x:x,y:y};}};$(function(){if(Core.userAgent!="mobile"){Tooltip.factory('[data-tooltip]',{key:'common'});}});var TypeAhead={node:null,html:null,timer:null,term:'',position:-1,items:[],cache:[],config:{},factory:function(node,config){var instance=Object.create(TypeAhead);instance.init(node,config);return instance;},init:function(node,config){this.node=$(node);if(!this.node.length){return false;}
this.config=$.extend({},{minLength:3,resultsLength:15,groupResults:false,termMatch:false,resultTypes:[],ghostQuery:false,useSearchList:false,selectKey:KeyCode.enter,throttle:200,source:null,onSelect:function(item,ta){ta.node.val(item.title||'');ta.close();},onStart:null,onFinish:null},config||{});if(this.config.minLength<=0){this.config.minLength=1;}
this.config.resultTypes.push('default');if(this.node.prop('nodeName').toLowerCase()==='input'){this.node.bind('keyup.ta',$.proxy(this.listen,this));this.node.bind('keydown.ta',$.proxy(this.trigger,this));this.html=$('<div/>').addClass('ui-typeahead').html(Msg.ui.loading).hide().appendTo('body');if(this.config.ghostQuery){this.ghost=$('<input/>').attr({type:'text',value:'',autocomplete:'off',readonly:'readonly','class':this.node.attr('class')}).addClass('input input-ghost').focus(function(){$(node).focus();});this.node.wrap($('<div/>').addClass('ui-typeahead-ghost')).before(this.ghost);}
$(document).bind('click.ta',$.proxy(this.close,this));this.node.bind('click.ta',Core.stopPropagation);this.html.bind('click.ta',Core.stopPropagation);}},close:function(){this.position=-1;this.html.hide();this._setGhostText();},finish:function(items){var config=this.config;this.items=items||[];this.cache=[];this._populate();this._position();if(Core.isCallback(config.onFinish)){config.onFinish(this.term,this);}},highlight:function(label,string){if(!string){string=label;}
var regexs=this.term.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&").split(' ');for(var i=0,regex;regex=regexs[i];i++){var l=string.toLowerCase().indexOf(regex.toLowerCase());var r=regex.length;string=label.substr(0,l)+'<em>'+label.substr(l,r)+'</em>'+label.substr(l+r);}
return string;},listen:function(){this.term=this.node.val();if(this.term.length<=0){this.close();}else{this._checkGhostText();}},start:function(){var config=this.config,type=$.type(config.source);if(Core.isCallback(config.onStart)){config.onStart(this.term,this);}
if(type==='function'){config.source(this.term,$.proxy(this.finish,this));}else if(type==='array'){this.finish(config.source);}},throttle:function(){if(this.timer!==null){window.clearTimeout(this.timer);this.timer=null;}
this.timer=window.setTimeout($.proxy(this.start,this),this.config.throttle);},trigger:function(e){var code=e.which,config=this.config,value=this.node.val();this._checkGhostText();if(!(code===KeyCode.arrowUp||code===KeyCode.arrowDown||code===config.selectKey||code===KeyCode.tab)){if((value.length+1)>=this.config.minLength){this.term=value.trim();this.throttle();}else if(value.length<=0){this.close();}
return;}
if(code===KeyCode.enter&&(this.html.is(':hidden')||this.position===-1)){this.node.parentsUntil('form').parent().submit();}else{e.preventDefault();e.stopPropagation();}
var cache=this.cache,items=this.html.find('a');items.removeClass('item-active');this._setGhostText();if(code===config.selectKey){if(this.position!=-1&&cache[this.position]){var item=cache[this.position];if(Core.isCallback(config.onSelect)){config.onSelect(item,this);}else if(item.url){Core.goTo(item.url);}}}else{if(code===KeyCode.arrowDown){this.position++;if(this.position>=items.length){this.position=0;}}else if(code===KeyCode.arrowUp){this.position--;if(this.position<=-1){this.position=items.length-1;}}else if(code===KeyCode.tab){this.position=0;}
if(cache[this.position]){items.eq(this.position).addClass('item-active');this.node.val(cache[this.position].title);}}},_position:function(){if(!this.items.length){this.close();return;}
var offset=this.node.offset();this.html.css({width:this.node.outerWidth(false),left:offset.left,top:offset.top+this.node.outerHeight(false)}).show();},_populate:function(){if(!this.items.length){return;}
this.html.empty();this.position=-1;var config=this.config,results=this.items,term=this.term,groups={};if(config.groupResults){for(var i=0,result;result=results[i];i++){if(!groups[result.type])groups[result.type]=[];groups[result.type].push(result);}}else{groups['default']=results;}
var div,ul,a,title,counter=0;for(var i=0,type;type=config.resultTypes[i];i++){if(counter>=config.resultsLength)break;if(groups[type]){var hasItems=false;ul=$('<ul/>');for(var x=0,item;item=groups[type][x];x++){var searchTerm=this.config.useSearchList?item.searchTerm:item.title;if(counter>=config.resultsLength){break;}else if(config.termMatch&&searchTerm.toLowerCase().indexOf(term.toLowerCase())<=-1){continue;}
title='<span class="title">'+this.highlight($('<div/>').text(item.title).html(),searchTerm)+'</span>';if(item.desc){title+=' <span class="desc">'+$('<div/>').text(item.desc).html()+'</span>';}
a=$('<a/>',{href:item.url,html:title,'class':item.className||''});if(item.icon||type==='friend'){var img=$('<img/>',{src:item.icon,width:(type==='product')?100:38,height:(type==='product')?50:38,'class':'icon'+((type==='friend')?' icon-frame':'')});a.html($('<div class="icon-desc"/>').append(a.html()));a.prepend(img);a.append($('<span class="clear"/>'));}
$('<li/>').append(a).appendTo(ul);counter++;hasItems=true;this.cache.push(item);}
if(hasItems){div=$('<div/>').addClass('group-list group-'+type);if(Msg.search&&Msg.search[type]){$('<span/>').addClass('group-title').html(Msg.search[type]).appendTo(div);}
div.append(ul).appendTo(this.html);}}}
if(counter){this._checkGhostText();}},_setGhostText:function(text){if(this.ghost){this.ghost.val(text||'');}},_checkGhostText:function(){if(this.ghost){if(this.cache[0]){var text=this.cache[0].title.trim(),term=this.node.val().trim();if(text.toLowerCase().indexOf(term.toLowerCase())===0){text=term+text.substr(term.length,(text.length-term.length));}else{text='';}
this._setGhostText(text);}else{this._setGhostText();}}}};var Comments={key:null,sig:null,count:0,wrapper:null,replyForm:null,replyInput:null,replyId:null,collection:null,throttleTimer:null,defaultCommentSort:'best',commentSortCookie:'discussion.sort',initialize:function(key,sig){var wrapper=$('#comments'),doc=$(document);Comments.key=key;Comments.sig=sig;Comments.wrapper=wrapper;if(wrapper.length&&key&&sig){var sortOrderPreference=Cookie.read(Comments.commentSortCookie);Comments.loadBase(1,null,sortOrderPreference);}
doc.delegate('#comments a.body-read','click',Comments.moreLess);doc.delegate('#comments .ui-pagination a','click',Comments.loadPage);doc.delegate('#comments .ui-pagination .page-next','click',Comments.loadPage);doc.delegate('#comments .ui-pagination .page-prev','click',Comments.loadPage);doc.delegate('#comments #comments-sorting-tabs .menu-best a','click',function(e){if(!$(this).hasClass('tab-active')){Comments.switchSortOrder('best');}});doc.delegate('#comments #comments-sorting-tabs .menu-latest a','click',function(e){if(!$(this).hasClass('tab-active')){Comments.switchSortOrder('latest');}});if(Core.isIE(6)){doc.delegate('#comments .comments-list li',{mouseover:function(){$(this).addClass('tile-hover');},mouseout:function(){$(this).removeClass('tile-hover');}});}},switchSortOrder:function(newSortOrder){Cookie.create(Comments.commentSortCookie,newSortOrder,{expires:8760,path:'/'});Comments.loadBase(1,null,newSortOrder);},add:function(button,isReply,callback){button=$(button);button.addClass('disabled').attr('disabled','disabled');var form=button.parentsUntil('form').parent(),detail=form.find('textarea'),error=form.find('.comments-error-form');error.find('li').hide();if(Comments.validate(form)){var noCache=new Date();noCache=noCache.getTime();var data={detail:$.trim(detail.val()),sig:Comments.sig,xstoken:Cookie.read('xstoken'),base:false,nocache:noCache};if(isReply&&Comments.collection){data.replyCommentId=Comments.replyId;}
$.ajax({url:Core.baseUrl+'/discussion/'+Comments.key+'/comment.json',type:'POST',data:data,dataType:'json',success:function(response){detail.val("");button.removeClass("disabled").removeAttr("disabled");Comments.cancelReply();if(response.commentId){if(!isReply){Comments.loadBase(1,callback,'latest');}else{Comments.loadBase(1,callback);}}else{Comments.showErrors(error,response.errors||['throttled']);button.removeClass('disabled').removeAttr('disabled');}},error:function(response){Overlay.open(response.statusText);button.removeClass('disabled').removeAttr('disabled');}});}else{Comments.showErrors(error,['required']);button.removeClass('disabled').removeAttr('disabled');}
return false;},decrement:function(){var node=$('#comments-total'),total=parseInt(node.text());node.text(total-1);},increment:function(){var node=$('#comments-total'),total=parseInt(node.text());node.text(total+1);},reply:function(targetId,collection,author){if(Comments.throttleTimer!==null){return;}
var target=$("#post-"+targetId);if(targetId===Comments.replyId){target.next().toggle();return;}
Comments.cancelReply();Comments.collection=collection;Comments.replyId=targetId;$('#comments li.nested-reply').remove();$('<li/>').addClass('nested-reply').append(Comments.replyForm).insertAfter(target);Comments.replyInput.focus().val('@'+author+': ');},cancelReply:function(){Comments.replyId=null;Comments.collection=null;Comments.replyForm.detach();Comments.replyInput.val("");return false;},toggleDelete:function(id){$('#post-'+id).find('.comment-foot').toggle().toggleClass('visible');},remove:function(id){var noCache=new Date();noCache=noCache.getTime();$.ajax({url:Core.baseUrl+'/discussion/'+id+'/deletecomment.json',type:'POST',data:{sig:Comments.sig,xstoken:Cookie.read('xstoken'),nocache:noCache},dataType:'json',success:function(response){if(response.success){Marketing.trackActivity('Comments','Delete Comment');$('#post-'+id).fadeOut('normal',function(){$(this).remove();Comments.decrement();});}}});},loadBase:function(page,callback,view){var noCache=new Date();noCache=noCache.getTime();page=page||1;view=view||Core.getHash()||Cookie.read('discussion.sort')||Comments.defaultCommentSort;$.ajax({url:Core.baseUrl+'/discussion/'+Comments.key+'/load.json',type:'GET',data:{page:page,base:true,sig:Comments.sig,xstoken:Cookie.read('xstoken'),nocache:noCache,view:view},dataType:'html',success:function(response){var newWrapper=$(response),oldWrapper=Comments.wrapper;newWrapper.insertBefore(oldWrapper);oldWrapper.remove();Comments.wrapper=newWrapper;Comments.replyForm=$('#comments-reply-form').detach().show();Comments.replyInput=Comments.replyForm.find('textarea');ReportPost.initialize(newWrapper,'comments');if(Core.isCallback(callback)){callback();}},error:function(response){Comments.wrapper.addClass('comments-error').find('.subheader-2').toggleClass('hide');}});},loadPage:function(e){e.preventDefault();e.stopPropagation();var noCache=new Date();noCache=noCache.getTime();var view=Core.getHash()||Cookie.read('discussion.sort')||Comments.defaultCommentSort;var self=$(e.currentTarget),page=parseInt(self.text())||parseInt(self.data("pagenum"))||1,list=$('#comments-'+page),pages=Comments.wrapper.find('.comments-pages');$.ajax({url:Core.baseUrl+'/discussion/'+Comments.key+'/load.json',type:'GET',data:{page:page,sig:Comments.sig,xstoken:Cookie.read('xstoken'),base:false,nocache:noCache,view:view},dataType:'html',success:function(response){if(response){Marketing.trackActivity('Comments','Load Page#'+page);$("#comments-list-wrapper").html(response);ReportPost.initialize($("#comments"),'comments');}}});},purge:function(node,notice){if(!confirm(notice)){return false;}
$(node).addClass('disabled').attr('disabled','disabled');var noCache=new Date();noCache=noCache.getTime();$.ajax({url:Core.baseUrl+'/discussion/'+Comments.key+'/purge.json',type:'POST',data:{sig:Comments.sig,xstoken:Cookie.read('xstoken'),nocache:noCache},dataType:'json',success:function(){Comments.loadBase();}});},poll:function(){var noCache=new Date();noCache=noCache.getTime();$.ajax({url:Core.baseUrl+'/discussion/'+Comments.key+'/poll.json',type:'GET',data:{sig:Comments.sig,xstoken:Cookie.read('xstoken'),nocache:noCache},dataType:'json',success:function(response){if(response.count&&response.count>Comments.count){var diff=response.count-Comments.count,node=$('#comments-pull');node.find('.pull-single, .pull-multiple').hide();node.find('.pull-'+(diff===1?'single':'multiple')).show().find('span').text(diff);node.slideDown();}}});},lock:function(node){$(node).addClass('disabled').attr('disabled','disabled');var noCache=new Date();noCache=noCache.getTime();$.ajax({url:Core.baseUrl+'/discussion/'+Comments.key+'/toggleLock.json',type:'POST',data:{sig:Comments.sig,xstoken:Cookie.read('xstoken'),nocache:noCache},dataType:'json',success:function(){Comments.loadBase();}});},moreLess:function(e){e.stop();var self=$(this),parent=self.parent();parent.hide();parent.siblings().show();return false;},showErrors:function(node,errors){for(var i=0,l=errors.length;i<l;i++){node.find('.error-'+errors[i]).show();}},throttle:function(millis){var lastTimestamp=Math.ceil(millis/1000),throttler=$('#comments .comments-throttler'),buttons=$('#comments .comments-action');if(throttler.length&&lastTimestamp<=60){throttler.find('.throttle-time').text(60-lastTimestamp);throttler.show();buttons.hide();$('.reply-button').attr("data-tooltip",Msg.cms.throttleError).addClass("disabled");clearTimeout(Comments.throttleTimer);Comments.throttleTimer=setTimeout(function(){Comments.countdown(throttler,buttons);},1000);}},countdown:function(throttler,buttons){var seconds=parseInt(throttler.eq(0).find('.throttle-time').text())||60,timeLeft=seconds-1;clearTimeout(Comments.throttleTimer);if(timeLeft<=0){Comments.throttleTimer=null;throttler.hide();buttons.show();$('.reply-button').removeAttr("data-tooltip").removeClass("disabled");}else{throttler.find('.throttle-time').text(timeLeft);Comments.throttleTimer=setTimeout(function(){Comments.countdown(throttler,buttons);},1000);}},updateHistory:function(page){History.push({key:Comments.key,sig:Comments.sig,page:page},'?page='+page+'#comments');},updatePagination:function(page){Comments.wrapper.find('.ui-pagination').each(function(){$(this).find('li').removeClass('current').eq(page-1).addClass('current');});},unbury:function(id){$('#post-'+id).removeClass('comment-buried');},validate:function(form){return($.trim(form.find('textarea').val())!=='');}};var ReportPost={contextWrapper:null,formWrapper:null,offensiveId:null,offensiveAuthor:null,initialize:function(wrapper,postType){if(typeof wrapperId==="string"){ReportPost.contextWrapper=$(wrapperId);}else{ReportPost.contextWrapper=wrapper;}
ReportPost.formWrapper=$("#report-post");ReportPost.offensiveId=$("#offensive-post-id");ReportPost.offensiveAuthor=$("#offensive-post-author");ReportPost.reportReason=$("#report-detail");ReportPost.reportSuccess=$("#report-success");ReportPost.postType=postType;ReportPost.bindEvents();},bindEvents:function(){$("a[data-vote-type='up']",ReportPost.contextWrapper).on("click",function(){ReportPost.ratePost(this)});$("a[data-vote-type='down']",ReportPost.contextWrapper).on("click",function(){ReportPost.ratePost(this)});$("a[data-vote-type='report']",ReportPost.contextWrapper).on("click",function(){ReportPost.openReportForm(this)});$(".report-submit",ReportPost.formWrapper).on("click",ReportPost.submitReport);$(".cancel-report",ReportPost.formWrapper).on("click",ReportPost.cancelReport);var rateContext=(ReportPost.postType==="forums")?".topic-post":".comment-tile";if(!Core.isIE(6)&&!Core.isIE(7)){$(ReportPost.contextWrapper).on("mouseover",rateContext,function(event){if(Core.loggedIn){$(".rate-up, .downvote-wrapper",this).not(".keep-shown").css("visibility","visible");}else{$(".rate-post-wrapper",this).css("visibility","visible");}}).on("mouseout",rateContext,function(event){if(Core.loggedIn){$(".rate-up, .downvote-wrapper",this).not(".keep-shown").css("visibility","hidden");}else{$(".rate-post-wrapper",this).css("visibility","hidden");}});}},ratePost:function(node){node=$(node);var postId=node.data("post-id");var voteType=node.data("vote-type");var voteVal=node.data("report-type");var ajaxUrl=Core.baseUrl;if(ReportPost.postType==="comments"){ajaxUrl+="/discussion/comment/";}else{ajaxUrl+="/forum/topic/post/";}
ajaxUrl+=(postId+"/"+voteType);$.ajax({type:'POST',url:ajaxUrl,data:{voteValue:voteVal,xstoken:Cookie.read('xstoken')},success:function(data){if(data.vote>0){node.addClass("keep-shown").parents(".rate-post-wrapper").addClass("upvoted").removeClass("downvoted");}else if(data.vote<0){node.parents(".rate-option").addClass("keep-shown").parents(".rate-post-wrapper").addClass("downvoted").removeClass("upvoted");}else{$(".keep-shown").removeClass("keep-shown");node.parents(".rate-post-wrapper").removeClass("downvoted").removeClass("upvoted");}
if(voteType==="down"){node.parents('.downvote-menu').hide();}},error:function(request,status,error){if(voteType==="down"){node.parents('.downvote-menu').hide();}
if(request.statusText.length===0){Core.goTo(window.location+'?login');return false;}
Overlay.open(request.statusText);}});},openReportForm:function(node){node=$(node);var postId=node.data("post-id");var voteType=node.data("vote-type");var voteVal=node.data("report-type");ReportPost.formWrapper.insertAfter($('#post-'+postId)).show();$('#report-success').hide();$('#report-table').show();node.parents('.downvote-menu').hide();ReportPost.offensiveId.html(node.data("post-id"));ReportPost.offensiveAuthor.html(node.data("post-author"));},submitReport:function(){var postId=ReportPost.offensiveId.html();var reportExplanation=$("#report-detail").val();if(reportExplanation===""){Overlay.open(Msg.cms.validationError);return;}
var ajaxUrl=Core.baseUrl;if(ReportPost.postType==="comments"){ajaxUrl+="/discussion/comment/";}else{ajaxUrl+="/forum/topic/post/";}
ajaxUrl+=(postId+"/report");$.ajax({type:"POST",url:ajaxUrl,data:{type:$('#report-reason').val(),reason:reportExplanation,xstoken:Cookie.read('xstoken')},success:function(data){$('#report-success').show();$('#report-table').hide();ReportPost.offensiveId.html("");ReportPost.offensiveAuthor.html("");},error:function(request,status,error){Overlay.open(request.statusText);}});},cancelReport:function(){ReportPost.formWrapper.hide();ReportPost.offensiveId.html("");ReportPost.offensiveAuthor.html("");if(ReportPost.postType==="comments"){ReportPost.formWrapper.insertAfter("#comments");}else{ReportPost.formWrapper.insertAfter("#post-list");}},ignoreUser:function(node,accountId,remove){node=$(node);node.parents(".ui-context").hide();var ignoreList=Cookie.read('bnetUserIgnore')
ignoreList=(ignoreList!=null)?decodeURIComponent(ignoreList).split(','):[];var arrayLoc=$.inArray(accountId.toString(),ignoreList);var actionTaken=false;if(remove){if(arrayLoc>-1){ignoreList.splice(arrayLoc,1);actionTaken=ReportPost.updateIgnoreList(ignoreList);}else{Overlay.open(Msg.cms.ignoreNot);}}else{if(arrayLoc<0){ignoreList.push(accountId);if(ignoreList.length>100){ignoreList.shift();}
actionTaken=ReportPost.updateIgnoreList(ignoreList);}else{Overlay.open(Msg.cms.ignoreAlready);}}
if(actionTaken){window.location.reload();}},updateIgnoreList:function(ignoreList){Cookie.create('bnetUserIgnore',encodeURIComponent(ignoreList.join(',')),{path:Core.baseUrl,expires:8760});return true;}};"use strict";var Lightbox={timeout:0,initialized:false,contents:[],currentIndex:0,contentType:"image",DEFAULT_WIDTH:480,DEFAULT_HEIGHT:360,anchorClose:true,config:{showTitle:false,includeControls:false},init:function(){Blackout.initialize();Lightbox.build();Lightbox.initialized=true;},storeContentData:function(content,contentType){if(!Lightbox.initialized){Lightbox.init();}
Lightbox.contents=content;Lightbox.contentType=contentType;Lightbox.currentIndex=0;Lightbox.controls.toggleClass("no-paging",(content.length<2));},loadImage:function(images,dontStore,showIndex){if(!Lightbox.initialized){Lightbox.init();}
if(!dontStore){Lightbox.storeContentData(images,"image");}
var index=showIndex||((typeof images==='number')?images:0);if(Lightbox.contents[index].src!==""){Lightbox.currentIndex=index;Lightbox.setFrameDimensions(Lightbox.DEFAULT_WIDTH,Lightbox.DEFAULT_HEIGHT);Lightbox.content.removeAttr("style").addClass("loading").removeClass("lightbox-error").html("");Lightbox.show();Lightbox.setImage(Lightbox.contents[index]);}else{Lightbox.error();}},setImage:function(image){if(Core.isIE(6)){if(Lightbox.controls.hasClass("no-paging")&&Lightbox.controls.hasClass("no-gallery")){Lightbox.controls.addClass("no-controls").removeClass("no-paging no-gallery");}}
Lightbox.preloadImage(image,function(loadedImage){Lightbox.emptyContent();Lightbox.setFrameDimensions(loadedImage.width,loadedImage.height);Lightbox.content.html(loadedImage);if(Lightbox.config.showTitle){Lightbox.title.html(image.title||"");}});},loadVideo:function(videos,dontStore,showIndex){if(!Lightbox.initialized){Lightbox.init();}
if(!dontStore){Lightbox.storeContentData(videos,"video");}
var index=showIndex||((typeof videos==='number')?videos:0);Lightbox.setVideo(videos[index]);},setVideo:function(video){var currentFlashVars={flvPath:(video.flvBase||Flash.videoBase)+video.flvPath,flvWidth:video.width,flvHeight:video.height,ratingPath:video.customRating,captionsPath:"",captionsDefaultOn:(Core.locale!=="en-us"&&Core.locale!=="en-gb")};if(!video.showRating||false){currentFlashVars=$.extend(Flash.defaultVideoFlashVars,currentFlashVars);}
var noCache=new Date();noCache="?nocache="+noCache.getTime();if(typeof video.captionsPath!=="undefined"&&video.captionsPath!==""){currentFlashVars.captionsPath=video.captionsPath;}else{delete currentFlashVars.captionsPath;}
if(typeof video.customRating!=="undefined"&&video.customRating!==""){if(video.customRating.indexOf("NONE")>-1){delete currentFlashVars.ratingPath;}else{currentFlashVars.ratingPath=video.customRating;}}else{currentFlashVars.ratingPath=Flash.ratingImage;}
Lightbox.emptyContent();$("<div id='flash-target' />").appendTo(Lightbox.content);swfobject.embedSWF(Flash.videoPlayer+noCache,"flash-target",video.width,video.height,Flash.requiredVersion,Flash.expressInstall,currentFlashVars,Flash.defaultVideoParams,{},Lightbox.flashEmbedCallback);if(Lightbox.config.showTitle){Lightbox.title.html(video.title||"");}
Lightbox.setFrameDimensions(video.width,video.height);Lightbox.show();},loadEmbed:function(embeds,dontStore,showIndex){if(!Lightbox.initialized){Lightbox.init();}
if(!dontStore){Lightbox.storeContentData(embeds,"embed");}
var index=showIndex||((typeof embeds==='number')?embeds:0);Lightbox.setEmbed(embeds[index]);},setEmbed:function(embed){Lightbox.emptyContent();$("<object width='"+embed.width+"' height='"+embed.height+"'>"+"<param name='movie' value='https://www.youtube.com/v/"+embed.src+"?autoplay=1'/>"+"<param name='allowFullScreen' value='true' />"+"<param name='allowScriptAccess' value='always'/>"+"<param name='wmode' value='opaque' />"+"<embed src='https://www.youtube.com/v/"+embed.src+"?autoplay=1' type='application/x-shockwave-flash' allowfullscreen='true' allowScriptAccess='always' wmode='opaque' width='"+embed.width+"' height='"+embed.height+"'/>"+"</object>").appendTo(Lightbox.content);if(Lightbox.config.showTitle){Lightbox.title.html(embed.title||"");}
Lightbox.setFrameDimensions(embed.width,embed.height);Lightbox.show();},viewInGallery:function(){Tooltip.hide();Core.goTo(Lightbox.contents[Lightbox.currentIndex].path);return false;},setFrameDimensions:function(width,height){if(width===0||height===0){Lightbox.error();}else{Lightbox.content.css({height:height+"px"});height=(Lightbox.config.showTitle)?height+Lightbox.title.height():height;height=(Lightbox.config.includeControls)?height+Lightbox.controls.height():height;Lightbox.container.css({top:Page.scroll.top+"px",width:width+"px",height:height+"px"});Lightbox.borderTop.width(width-10+"px");Lightbox.borderbottom.width(width-12+"px");Lightbox.borderRight.height(height-9+"px");Lightbox.borderLeft.height(height-9+"px");}},checkGalleryLinkDisplay:function(hasPath){Lightbox.controls.toggleClass("no-gallery",hasPath);},preloadImage:function(loadingImage,callback){var tempImage=new Image();$(tempImage).load(function(){callback(tempImage);});tempImage.src=loadingImage.src;},show:function(){Blackout.show(function(){Lightbox.container[0].style.display="block";Lightbox.checkGalleryLinkDisplay(!(Lightbox.contents[Lightbox.currentIndex].path));},Lightbox.close);},close:function(){clearTimeout(Lightbox.timeout);Blackout.hide(Lightbox.container.hide());if(Lightbox.contentType==="video"){swfobject.removeSWF("flash-target");}
if(Lightbox.contentType==="embed"){Lightbox.emptyContent();}
Tooltip.hide();},emptyContent:function(){Lightbox.content.removeAttr("style").removeClass("loading lightbox-error").empty();},error:function(){Lightbox.emptyContent();Lightbox.setFrameDimensions(Lightbox.DEFAULT_WIDTH,Lightbox.DEFAULT_HEIGHT);Lightbox.content.addClass("lightbox-error").html("Error loading content.");Lightbox.show();},build:function(){Lightbox.anchor=$('<div id="lightbox-anchor" />').click(function(){if(Lightbox.anchorClose){Lightbox.close();}});Lightbox.container=$('<div id="lightbox-container" />').mouseover(function(){Lightbox.anchorClose=false}).mouseout(function(){Lightbox.anchorClose=true}).appendTo(Lightbox.anchor);Lightbox.title=$('<h1 id="lightbox-title" />').mouseover(function(){Lightbox.anchorClose=false}).mouseout(function(){Lightbox.anchorClose=true}).appendTo(Lightbox.container);Lightbox.content=$('<div id="lightbox-content"/>').mouseover(function(){Lightbox.anchorClose=false}).mouseout(function(){Lightbox.anchorClose=true}).appendTo(Lightbox.container).click(Lightbox.next);var uiElementLink=$("<a />").addClass("ui-element").attr("href","javascript:;");Lightbox.controls=$('<div class="control-wrapper no-paging no-gallery" />');Lightbox.controls.append($('<div class="lightbox-controls ui-element" />').append(uiElementLink.clone().addClass("previous").click(Lightbox.previous)).append(uiElementLink.clone().addClass("next").click(Lightbox.next)).append(uiElementLink.clone().addClass("gallery-view").click(Lightbox.viewInGallery).mouseover(function(){Tooltip.instances.common.show(this,Msg.ui.viewInGallery);Tooltip.instances.common.wrapper.css("z-index","9007");}).mouseout(function(){Tooltip.instances.common.wrapper.css("z-index","1000")})));var border=$("<div />").addClass("border");Lightbox.borderTop=border.clone().attr("id","lb-border-top");Lightbox.borderRight=border.clone().attr("id","lb-border-right");Lightbox.borderbottom=border.clone().attr("id","lb-border-bottom");Lightbox.borderLeft=border.clone().attr("id","lb-border-left");var corner=$("<div />").addClass("corner");Lightbox.container.append(corner.clone().addClass("corner-top-left")).append(corner.clone().addClass("corner-top-right")).append(corner.clone().addClass("corner-bottom-left")).append(corner.clone().addClass("corner-bottom-right")).append(Lightbox.borderTop).append(Lightbox.borderRight).append(Lightbox.borderbottom).append(Lightbox.borderLeft).append(Lightbox.controls).append(uiElementLink.clone().addClass("lightbox-close").click(Lightbox.close));Lightbox.anchor.appendTo("body");if(Core.isIE(6)){Lightbox.content.show().hide();}},next:function(){var totalContent=Lightbox.contents.length;if(totalContent>1){Lightbox.currentIndex++;if(Lightbox.currentIndex>=totalContent){Lightbox.currentIndex=0;}
if(Lightbox.contentType==="image"){Lightbox.setImage(Lightbox.contents[Lightbox.currentIndex]);}else if(Lightbox.contentType==="video"){Lightbox.setVideo(Lightbox.contents[Lightbox.currentIndex]);}else if(Lightbox.contentType==="embed"){Lightbox.setEmbed(Lightbox.contents[Lightbox.currentIndex])}}},previous:function(){var totalContent=Lightbox.contents.length;if(totalContent>1){Lightbox.currentIndex--;if(Lightbox.currentIndex<0){Lightbox.currentIndex=Lightbox.contents.length-1;}
if(Lightbox.contentType==="image"){Lightbox.setImage(Lightbox.contents[Lightbox.currentIndex]);}else if(Lightbox.contentType==="video"){Lightbox.setVideo(Lightbox.contents[Lightbox.currentIndex]);}else if(Lightbox.contentType==="embed"){Lightbox.setEmbed(Lightbox.contents[Lightbox.currentIndex]);}}},flashEmbedCallback:function(e){if(!e.success){Lightbox.content.html(Flash.getFlashError());}}};